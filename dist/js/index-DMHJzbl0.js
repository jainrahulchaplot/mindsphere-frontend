const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/voice-features-BuzIv5ek.js","js/ui-vendor-D7u3Yckq.js","js/react-vendor-Bv4S-FFt.js","js/livekit-vendor-Bx6QDId7.js","js/supabase-vendor-CiY40RCd.js"])))=>i.map(i=>d[i]);
import{j as e,b as t,d as s,c as a,u as n,Q as i,e as r}from"./ui-vendor-D7u3Yckq.js";import{a as l,r as o,R as d,u as c,b as m,d as u,B as x,N as h,e as g,f as p}from"./react-vendor-Bv4S-FFt.js";import{S as b,P as f,H as v,D as j,u as y,a as w,M as N,b as k,c as S,V as _,d as C,e as D,f as E,C as M,g as I,h as $,i as P,j as A,k as T,l as F,m as L,n as R,o as z,s as Y,p as O,q,r as V,t as G,v as W,w as B,A as H,x as K}from"./voice-features-BuzIv5ek.js";import{_ as U}from"./supabase-vendor-CiY40RCd.js";import{C as X,B as J}from"./journal-features-CAbClwr2.js";import"./livekit-vendor-Bx6QDId7.js";var Q;!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Z=l;Q=Z.createRoot,Z.hydrateRoot;const ee=o.createContext(void 0);function te({children:t}){const[s,a]=o.useState(null),[n,i]=o.useState(null),[r,l]=o.useState(.8),c=o.useCallback(()=>{s&&(s.pause(),s.currentTime=0,a(null),i(null))},[s]),m=o.useCallback((e,t)=>{c(),a(e),i(t),e.play().catch(e=>{a(null),i(null)})},[c]),u=o.useCallback(e=>n===e&&s&&!s.paused,[n,s]),x=o.useCallback(e=>{l(e),s&&(s.volume=e)},[s]);return d.useEffect(()=>{s&&(s.volume=r)},[s,r]),e.jsx(ee.Provider,{value:{currentAudio:s,currentAudioType:n,globalVolume:r,playAudio:m,stopAllAudio:c,isPlaying:u,setGlobalVolume:x},children:t})}function se(){const e=o.useContext(ee);if(void 0===e)throw new Error("useAudio must be used within an AudioProvider");return e}const ae=o.createContext(void 0),ne=()=>{const e=o.useContext(ae);if(!e)throw new Error("useAudioManager must be used within an AudioManagerProvider");return e},ie=({children:t})=>{const[s,a]=o.useState(null),n=o.useRef(new Map),i=o.useCallback(e=>e.startsWith("ambient-"),[]),r=o.useCallback((e,t)=>{n.current.set(e,t),i(e)||l(e),a(e)},[i]),l=o.useCallback(e=>{n.current.forEach((t,s)=>{s!==e&&t.current&&t.current.pause()})},[]),d=o.useCallback(()=>{n.current.forEach(e=>{e.current&&e.current.pause()}),a(null)},[]),c={currentlyPlaying:s,playAudio:r,pauseAllExcept:l,pauseAll:d,isAmbientPlayer:i};return e.jsx(ae.Provider,{value:c,children:t})},re=({className:t="w-5 h-5",size:s})=>e.jsx(b,{size:s||20,className:t}),le=({className:t="w-5 h-5",size:s})=>e.jsx(f,{size:s||20,className:t});function oe({userId:t}){const{data:s,isLoading:a}=y(t),{data:n,isLoading:i,error:r}=w(),{globalVolume:l,setGlobalVolume:d}=se(),c=s?.current_streak??0,m=n?.tracks||[],[u,x]=o.useState(0),[h,g]=o.useState(!1),[p,b]=o.useState(!1),f=o.useRef(null),v=m[u];o.useEffect(()=>{f.current||(f.current=new Audio,f.current.volume=l,f.current.loop=!1)},[]),o.useEffect(()=>{f.current&&v&&(f.current.src=v.url)},[v]),o.useEffect(()=>{f.current&&(h?f.current.play().catch(e=>{g(!1)}):f.current.pause())},[h]),o.useEffect(()=>{f.current&&(f.current.volume=l)},[l]),o.useEffect(()=>{if(!f.current)return;const e=()=>{const e=(u+1)%m.length;x(e),h&&m.length>0&&setTimeout(()=>{f.current&&f.current.play().catch(e=>{})},100)};return f.current.addEventListener("ended",e),()=>{f.current&&f.current.removeEventListener("ended",e)}},[u,m.length,h]);return e.jsxs("div",{className:"relative backdrop-blur-xl bg-gradient-to-r from-slate-900/40 via-purple-900/20 to-slate-900/40 border-b border-white/10 shadow-2xl",children:[e.jsxs("div",{className:"container-narrow flex items-center justify-between py-4",children:[e.jsx("a",{href:"/",className:"flex items-center gap-3 hover:opacity-80 transition-all duration-300 group",children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:"/assets/mindsphere logo.png",alt:"MindSphere",className:"h-8 w-auto select-none max-h-8 transition-transform duration-300 group-hover:scale-105"}),e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-lg blur-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})}),e.jsx("div",{className:"flex items-center gap-4",children:a?e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-white/5 border border-white/10 rounded-xl backdrop-blur-sm",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("div",{className:"text-xs text-white/60 font-medium",children:"â€”"})]}):e.jsxs("div",{className:"flex items-center gap-2 bg-gradient-to-r from-orange-500/20 to-red-500/20 border border-orange-400/30 rounded-xl px-4 py-2 backdrop-blur-sm hover:from-orange-500/30 hover:to-red-500/30 transition-all duration-300 group",children:[e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"w-5 h-5 text-orange-400 group-hover:scale-110 transition-transform duration-300"}),e.jsx("div",{className:"absolute -inset-1 bg-orange-400/20 rounded-full blur-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsx("div",{className:"text-sm text-white font-semibold tracking-wide",children:c}),e.jsxs("div",{className:"text-xs text-orange-300/70 font-medium",children:["day",1!==c?"s":""]})]})})]}),e.jsx("div",{className:"border-t border-white/10",children:e.jsxs("div",{className:"container-narrow px-4 py-3 relative z-10",children:[i?e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("div",{className:"text-sm text-white/70 font-medium",children:"Loading ambient music..."})]})}):r?e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-red-400 text-lg",children:"âš ï¸"}),e.jsx("div",{className:"text-sm text-red-300 font-medium",children:"Error loading music"})]})}):0===m.length?e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"text-sm text-white/50 font-medium",children:[e.jsx(N,{className:"w-4 h-4"})," No ambient tracks available"]})}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-indigo-500/30 to-purple-500/30 rounded-lg flex items-center justify-center backdrop-blur-sm border border-indigo-400/30",children:e.jsx("div",{className:"text-indigo-300 text-lg font-bold",children:"â™ª"})}),h&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse"})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-sm text-white font-medium truncate",children:v?v.title:"No track"}),e.jsx("div",{className:"text-xs text-white/60",children:m.length>0?`${u+1} of ${m.length}`:""})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[e.jsx("button",{onClick:()=>{if(0===m.length)return;const e=0===u?m.length-1:u-1;x(e),h&&f.current&&setTimeout(()=>{f.current&&f.current.play().catch(e=>{})},100)},className:"w-10 h-10 flex items-center justify-center text-white/70 hover:text-white transition-all duration-300 rounded-xl hover:bg-white/10 active:scale-95 backdrop-blur-sm border border-white/10 hover:border-white/20",disabled:m.length<=1,style:{pointerEvents:"auto"},children:e.jsx("div",{className:"text-lg",children:"â®"})}),e.jsx("button",{onClick:()=>{0!==m.length&&g(!h)},className:"w-12 h-12 flex items-center justify-center text-white hover:text-white transition-all duration-300 rounded-xl bg-gradient-to-r from-blue-500/20 to-purple-500/20 hover:from-blue-500/30 hover:to-purple-500/30 active:scale-95 backdrop-blur-sm border border-white/20 hover:border-white/30",style:{pointerEvents:"auto"},children:h?e.jsx(k,{className:"w-5 h-5"}):e.jsx(S,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{if(0===m.length)return;const e=(u+1)%m.length;x(e),h&&f.current&&setTimeout(()=>{f.current&&f.current.play().catch(e=>{})},100)},className:"w-10 h-10 flex items-center justify-center text-white/70 hover:text-white transition-all duration-300 rounded-xl hover:bg-white/10 active:scale-95 backdrop-blur-sm border border-white/10 hover:border-white/20",disabled:m.length<=1,style:{pointerEvents:"auto"},children:e.jsx("div",{className:"text-lg",children:"â­"})})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{onClick:()=>b(!p),className:"w-10 h-10 flex items-center justify-center text-white/70 hover:text-white transition-all duration-300 rounded-xl hover:bg-white/10 active:scale-95 backdrop-blur-sm border border-white/10 hover:border-white/20",style:{pointerEvents:"auto"},children:0===l?e.jsx(_,{className:"w-5 h-5"}):l>.7?e.jsx(C,{className:"w-5 h-5"}):e.jsx(D,{className:"w-5 h-5"})})})]}),p&&e.jsx("div",{className:"mt-3 pt-3 border-t border-white/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs text-white/60 font-medium",children:"Volume"}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:l,onChange:e=>d(parseFloat(e.target.value)),className:"flex-1 h-2 bg-white/10 rounded-lg appearance-none cursor-pointer slider",style:{pointerEvents:"auto",background:`linear-gradient(to right, #6366f1 0%, #6366f1 ${100*l}%, rgba(255,255,255,0.1) ${100*l}%, rgba(255,255,255,0.1) 100%)`}}),e.jsxs("div",{className:"text-xs text-white/60 font-medium w-8 text-right",children:[Math.round(100*l),"%"]})]})})]})})]})}const de=[{path:"/",label:"Serenity",icon:({className:t="w-5 h-5",size:s})=>e.jsx(v,{size:s||20,className:t})},{path:"/dashboard",label:"Insights",icon:({className:t="w-5 h-5",size:s})=>e.jsx(j,{size:s||20,className:t})},{path:"/ai-buddy",label:"AI Buddy",icon:({className:t="w-5 h-5",size:s})=>e.jsx("svg",{width:s||20,height:s||20,className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}];function ce({userId:t}){const s=c(),a=m();return e.jsxs("div",{className:"mobile-nav-bar",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/95 via-indigo-900/80 to-purple-900/60 backdrop-blur-xl"}),e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-2 left-4 w-1 h-1 bg-indigo-400/60 rounded-full animate-twinkle",style:{animationDelay:"0s"}}),e.jsx("div",{className:"absolute top-4 right-8 w-0.5 h-0.5 bg-purple-400/40 rounded-full animate-twinkle",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute top-6 left-12 w-1.5 h-1.5 bg-indigo-300/50 rounded-full animate-twinkle",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-3 right-16 w-0.5 h-0.5 bg-purple-300/60 rounded-full animate-twinkle",style:{animationDelay:"0.5s"}}),e.jsx("div",{className:"absolute top-5 left-20 w-1 h-1 bg-indigo-500/40 rounded-full animate-twinkle",style:{animationDelay:"1.5s"}})]}),e.jsxs("div",{className:"relative z-10 flex items-center justify-around max-w-md mx-auto",children:[de.map(t=>{const n=s.pathname===t.path,i=t.icon;return e.jsxs("button",{onClick:()=>a(t.path),className:"group flex flex-col items-center py-2 px-3 rounded-2xl transition-all duration-500 min-h-[48px] min-w-[48px] relative overflow-hidden "+(n?"text-white":"text-slate-400 hover:text-white"),children:[n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/30 to-purple-600/30 rounded-2xl"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-400/20 to-purple-500/20 rounded-2xl animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-300/10 to-purple-400/10 rounded-2xl animate-pulse",style:{animationDelay:"0.5s"}})]}),!n&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-purple-600/10 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"relative z-10 transform transition-all duration-300 group-hover:scale-110 group-active:scale-95",children:e.jsx(i,{className:"w-6 h-6 mb-1 transition-all duration-300 "+(n?"drop-shadow-lg":"group-hover:drop-shadow-md")})}),e.jsx("span",{className:"text-xs font-medium transition-all duration-300 relative z-10 "+(n?"text-white":"text-slate-400 group-hover:text-white"),children:t.label}),n&&e.jsx("div",{className:"absolute -bottom-1 w-1 h-1 bg-indigo-400 rounded-full animate-pulse"})]},t.path)}),e.jsxs("button",{onClick:()=>a("/profile"),className:"group flex flex-col items-center py-2 px-3 rounded-2xl transition-all duration-500 min-h-[48px] min-w-[48px] relative overflow-hidden "+("/profile"===s.pathname?"text-white":"text-slate-400 hover:text-white"),children:["/profile"===s.pathname&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/30 to-purple-600/30 rounded-2xl"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-400/20 to-purple-500/20 rounded-2xl animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-300/10 to-purple-400/10 rounded-2xl animate-pulse",style:{animationDelay:"0.5s"}})]}),"/profile"!==s.pathname&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-purple-600/10 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"relative z-10 transform transition-all duration-300 group-hover:scale-110 group-active:scale-95",children:e.jsx(le,{className:"w-6 h-6 mb-1 transition-all duration-300 "+("/profile"===s.pathname?"drop-shadow-lg":"group-hover:drop-shadow-md")})}),e.jsx("span",{className:"text-xs font-medium transition-all duration-300 relative z-10 "+("/profile"===s.pathname?"text-white":"text-slate-400 group-hover:text-white"),children:"Profile"}),"/profile"===s.pathname&&e.jsx("div",{className:"absolute -bottom-1 w-1 h-1 bg-indigo-400 rounded-full animate-pulse"})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-indigo-400/50 to-transparent"})]})}const me=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,ue=(e,t)=>new Date(e.getFullYear(),e.getMonth(),e.getDate()+t),xe=e=>new Date(e.getFullYear(),e.getMonth(),1);function he({userId:s}){const[a,n]=o.useState(new Date),[i,r]=o.useState("meditation"),l=xe(a),d=(c=a,new Date(c.getFullYear(),c.getMonth()+1,0));var c;const m=me(l),u=me(d),x=me(new Date),h=t({queryKey:["usage-month",s,m,u,i],queryFn:async()=>{const{api:e}=await U(async()=>{const{api:e}=await import("./voice-features-BuzIv5ek.js").then(e=>e.y);return{api:e}},__vite__mapDeps([0,1,2,3,4]));return(await e.get(`/usage/daily?from=${m}&to=${u}&kind=${i}`)).data},enabled:!!s}),g=t({queryKey:["usage-overall",s,h.data?.first_use_date,i],queryFn:async()=>{const e=h.data?.first_use_date;if(!e)throw new Error("No first use date available");const{api:t}=await U(async()=>{const{api:e}=await import("./voice-features-BuzIv5ek.js").then(e=>e.y);return{api:e}},__vite__mapDeps([0,1,2,3,4]));return(await t.get(`/usage/daily?from=${e}&to=${x}&kind=${i}`)).data},enabled:!!s&&!!h.data?.first_use_date,staleTime:6e4}),p=o.useMemo(()=>{const e=new Map;return h.data?.days.forEach(t=>e.set(t.date,t)),e},[h.data]),b=o.useMemo(()=>{if(!g.data)return null;const e=[...g.data.days].sort((e,t)=>e.date.localeCompare(t.date)).find(e=>e.sessions>0);return e?.date??null},[g.data]),f=o.useMemo(()=>!!h.data&&(!h.data.first_use_date||0===h.data.analytics.totalSessions),[h.data]),v=o.useMemo(()=>{if(!h.data)return[];const e=(e=>{const t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),s=(t.getDay()+6)%7;return t.setDate(t.getDate()-s),t})(l),t=[];for(let s=0;s<42;s++){const n=ue(e,s),i=me(n),r=p.get(i);let l="",o=!1;const d=h.data.first_use_date;d&&i<d||i>x?l="":r?.sessions&&r.sessions>0?l="bg-green-500":f?(l="bg-indigo-400/30",o=!0):l="bg-red-500";const c=!!b&&i<b;t.push({key:i,dayNumber:n.getDate(),isCurrentMonth:n.getMonth()===a.getMonth(),isToday:i===x,dotColor:l,isDimmed:c,isPlaceholder:o})}return t},[h.data,l,a,p,x,b,f]),j=o.useMemo(()=>{const e=h.data;return e?{totalSessions:e.analytics.totalSessions,totalMinutes:e.analytics.totalMinutes,completionRate:e.analytics.completionRate,avgSessionDuration:e.analytics.avgSessionDuration,longestBreak:e.analytics.longestBreak,kind:e.analytics.kind}:null},[h.data]),y=o.useMemo(()=>{const e=g.data;return e?{currentStreak:e.streaks.current,bestStreak:e.streaks.best}:null},[g.data]),w=o.useMemo(()=>{if(!b)return null;const[e,t]=b.split("-").map(Number);return new Date(e,t-1,1)},[b]),N=o.useMemo(()=>{if(!w)return!0;return new Date(a.getFullYear(),a.getMonth()-1,1)>=xe(w)},[a,w]),k=e=>{("prev"!==e||N)&&n(t=>new Date(t.getFullYear(),t.getMonth()+("next"===e?1:-1),1))};if(h.error||g.error)return e.jsxs(X,{children:[e.jsx("div",{className:"heading bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent",children:"Habit tracker"}),e.jsxs("div",{className:"text-red-400 text-sm mt-2",children:["Failed to load data",e.jsx("button",{onClick:()=>{h.refetch(),g.refetch()},className:"ml-2 text-blue-400 hover:text-blue-300 underline",children:"Retry"})]})]});const S=h.isLoading||g.isLoading;return e.jsxs(X,{children:[e.jsx("div",{className:"heading bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent",children:"Habit tracker"}),e.jsxs("div",{className:"flex mt-3 mb-2",children:[e.jsx("button",{onClick:()=>r("meditation"),className:"flex-1 py-2 px-3 text-sm font-medium rounded-l-md transition-colors "+("meditation"===i?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"Meditation"}),e.jsx("button",{onClick:()=>r("sleep_story"),className:"flex-1 py-2 px-3 text-sm font-medium rounded-r-md transition-colors "+("sleep_story"===i?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"Sleep Story"})]}),e.jsxs("div",{className:"flex items-center justify-center mt-3",children:[e.jsx("button",{onClick:()=>k("prev"),disabled:!N,className:"mr-3 p-1 rounded transition-colors "+(N?"hover:bg-white/10":"opacity-30 cursor-not-allowed"),"aria-label":"Previous month",children:"â†"}),e.jsxs("div",{className:"text-sm font-medium",children:[["January","February","March","April","May","June","July","August","September","October","November","December"][a.getMonth()]," ",a.getFullYear()]}),e.jsx("button",{onClick:()=>k("next"),className:"ml-3 p-1 hover:bg-white/10 rounded transition-colors","aria-label":"Next month",children:"â†’"})]}),e.jsx("div",{className:"flex justify-center mt-2",children:e.jsx("button",{onClick:()=>n(new Date),className:"text-xs text-silver hover:text-white px-2 py-1 rounded transition-colors",children:"Today"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Mo","Tu","We","Th","Fr","Sa","Su"].map(t=>e.jsx("div",{className:"text-xs text-silver text-center py-1",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:S?Array.from({length:42}).map((t,s)=>e.jsx("div",{className:"aspect-square flex items-center justify-center",children:e.jsx("div",{className:"w-3 h-3 bg-gray-700 rounded-full animate-pulse"})},s)):v.map(t=>e.jsxs("div",{className:`aspect-square flex flex-col items-center justify-center text-sm transition-all hover:scale-110 ${t.isCurrentMonth?t.isDimmed?"text-white/30":"text-white":"text-silver/50"} ${t.isToday?"ring-1 ring-white/30 rounded":""}`,children:[e.jsx("div",{className:"text-xs mb-1 font-medium",children:t.dayNumber}),t.dotColor&&e.jsx("div",{className:`w-3 h-3 rounded-full ${t.dotColor} ${t.isDimmed?"opacity-30":""} ${t.isPlaceholder?"animate-pulse":""}`})]},t.key))})]}),e.jsx("div",{className:"flex items-center justify-center gap-4 mt-3 text-xs text-silver",children:f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-indigo-400/30 rounded-full animate-pulse"}),e.jsx("span",{children:"Start your journey"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{children:"Completed"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{children:"Done"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{children:"Missed"})]})]})}),j&&!f&&e.jsx("div",{className:"border-t border-white/10 mt-4 pt-4",children:y&&e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-silver text-xs",children:"Current Streak"}),e.jsxs("div",{className:"font-medium text-indigo-400 text-sm",children:[y.currentStreak," days"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-silver text-xs",children:"Best Streak"}),e.jsxs("div",{className:"font-medium text-purple-400 text-sm",children:[y.bestStreak," days"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-silver text-xs",children:"Longest Break"}),e.jsxs("div",{className:"font-medium text-red-400 text-sm",children:[j.longestBreak," days"]})]})]})}),!S&&f&&e.jsxs("div",{className:"text-center mt-6 py-6 bg-gradient-to-br from-indigo-500/10 to-purple-600/10 rounded-xl border border-indigo-400/20",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸŒŸ"}),e.jsx("div",{className:"text-white font-medium text-lg mb-2",children:"Start Your Mindfulness Journey"}),e.jsx("div",{className:"text-silver text-sm mb-4 max-w-sm mx-auto",children:"Complete your first meditation session to begin building your habit streak. Each day you practice will light up your calendar!"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-indigo-300",children:[e.jsx("div",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-pulse"}),e.jsx("span",{children:"Ready to begin? Head to the home page to start your first session"})]})]}),!S&&!h.data&&e.jsxs("div",{className:"text-center mt-4 py-8",children:[e.jsx("div",{className:"text-silver text-sm mb-2",children:"Make your first session to start your habit!"}),e.jsx("button",{className:"text-blue-400 hover:text-blue-300 text-sm underline",children:"Go to Home"})]})]})}function ge(e={}){const{onVisible:t,onHidden:s}=e,a=o.useRef(!0);return o.useEffect(()=>{const e=()=>{document.hidden?(a.current=!1,s?.()):(a.current=!0,t?.())},n=()=>{a.current=!1,s?.()};return document.addEventListener("visibilitychange",e),window.addEventListener("beforeunload",n),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("beforeunload",n)}},[t,s]),{isVisible:a.current}}function pe({userId:t}){const a=m(),n=c(),{playAudio:i,pauseAllExcept:r}=ne(),[l,d]=o.useState({kind:"meditation",mood:"all",search:""}),[u,x]=o.useState(null),h=o.useRef(new Map),g=o.useRef(null);ge({onHidden:()=>{h.current.forEach(e=>{e.paused||e.pause()}),x(null)},onVisible:()=>{}}),o.useEffect(()=>()=>{h.current.forEach(e=>{e.paused||e.pause()}),x(null)},[n.pathname]);const{data:p,fetchNextPage:b,hasNextPage:f,isFetchingNextPage:j,isLoading:y,error:w,refetch:N}=s({queryKey:["sessions",t,l.kind,l.search],queryFn:async({pageParam:e=1})=>{const t=new URLSearchParams({kind:l.kind,page:e.toString(),limit:"20",...l.search&&{q:l.search}}),{api:s}=await U(async()=>{const{api:e}=await import("./voice-features-BuzIv5ek.js").then(e=>e.y);return{api:e}},__vite__mapDeps([0,1,2,3,4]));return(await s.get(`/library?${t}`)).data},initialPageParam:1,getNextPageParam:(e,t)=>{if(!(e.sessions.length<20))return t.length+1},enabled:!!t,staleTime:0,refetchOnWindowFocus:!1,refetchOnMount:!0}),k=o.useMemo(()=>p?.pages?p.pages.map(e=>e.sessions).flat():[],[p]),S=o.useMemo(()=>p?.pages?.[0]?.stats?p.pages[0].stats:null,[p]);o.useEffect(()=>{N()},[l.kind,l.search,N]);const _=o.useCallback(e=>{y||(g.current&&g.current.disconnect(),g.current=new IntersectionObserver(e=>{e[0].isIntersecting&&f&&!j&&b()}),e&&g.current.observe(e))},[y,f,j,b]),C=o.useMemo(()=>{if(!k)return[];let e=[...k];return"all"!==l.mood&&(e=e.filter(e=>e.mood===l.mood)),e.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())},[k,l.mood]),D=e=>{const t=new Date(e),s=new Date,a=new Date(s.getTime()-864e5);return t.toDateString()===s.toDateString()?"Today":t.toDateString()===a.toDateString()?"Yesterday":t.toISOString().split("T")[0]},I=e=>{const t=Math.round(e/60);if(t<60)return`${t}m`;{const e=Math.floor(t/60),s=t%60;return s>0?`${e}h ${s}m`:`${e}h`}};if(w)return e.jsxs(X,{children:[e.jsx("div",{className:"heading bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent",children:"All sessions"}),e.jsxs("div",{className:"text-red-400 text-sm mt-2",children:["Failed to load sessions",e.jsx("button",{onClick:()=>N(),className:"ml-2 text-blue-400 hover:text-blue-300 underline",children:"Retry"})]})]});const $=S,P=(()=>{if(!k)return[];const e=k.reduce((e,t)=>(t.mood&&(e[t.mood]=(e[t.mood]||0)+1),e),{});return Object.entries(e).filter(([e,t])=>t>0).map(([e,t])=>e)})();return e.jsxs(X,{children:[e.jsx("div",{className:"heading bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent",children:"All sessions"}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex bg-white/5 rounded-lg p-1",role:"tablist","aria-label":"Session type",children:[e.jsx("button",{onClick:()=>d(e=>({...e,kind:"meditation",mood:"all"})),className:"flex-1 px-3 py-2 rounded-md text-xs font-medium transition-all "+("meditation"===l.kind?"bg-gradient-to-r from-indigo-500/20 to-purple-600/20 text-white border border-indigo-400/30":"text-white/70 hover:text-white"),role:"tab","aria-selected":"meditation"===l.kind,"aria-controls":"meditation-panel",children:"Meditation"}),e.jsx("button",{onClick:()=>d(e=>({...e,kind:"sleep_story",mood:"all"})),className:"flex-1 px-3 py-2 rounded-md text-xs font-medium transition-all "+("sleep_story"===l.kind?"bg-gradient-to-r from-indigo-500/20 to-purple-600/20 text-white border border-indigo-400/30":"text-white/70 hover:text-white"),role:"tab","aria-selected":"sleep_story"===l.kind,"aria-controls":"sleep-story-panel",children:"Sleep Story"})]}),$&&e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs mt-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-silver text-xs",children:"Total Sessions"}),e.jsx("div",{className:"font-medium text-indigo-400 text-sm",children:$?.totalSessions||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-silver text-xs",children:"Total Time"}),e.jsx("div",{className:"font-medium text-purple-400 text-sm",children:I($?.totalTime||0)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-silver text-xs",children:"Completion Rate"}),e.jsxs("div",{className:"font-medium text-green-400 text-sm",children:[$?.completionRate||0,"%"]})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{value:"all",label:"All Moods"},{value:"calm",label:"Calm"},{value:"anxious",label:"Anxious"},{value:"stressed",label:"Stressed"},{value:"focused",label:"Focused"},{value:"tired",label:"Tired"},{value:"sad",label:"Sad"},{value:"grateful",label:"Grateful"},{value:"peaceful",label:"Peaceful"},{value:"energetic",label:"Energetic"}].filter(e=>"all"===e.value||P.includes(e.value)).map(t=>e.jsx("button",{onClick:()=>d(e=>({...e,mood:t.value})),className:"px-3 py-1.5 text-xs rounded-full border transition-all flex items-center gap-2 "+(l.mood===t.value?"bg-gradient-to-r from-indigo-500/20 to-purple-600/20 border-indigo-400/50 text-white":"border-white/20 text-silver hover:text-white hover:border-white/40"),children:t.label},t.value))}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search mood, session name, notes...",value:l.search,onChange:e=>d(t=>({...t,search:e.target.value})),className:"w-full px-3 py-2 pl-8 text-xs bg-graphite/50 border border-white/20 rounded-lg text-white placeholder-silver/60 focus:outline-none focus:ring-2 focus:ring-indigo-400/50 focus:border-indigo-400/50"}),e.jsx("div",{className:"absolute left-2.5 top-2.5 text-silver/60",children:e.jsx(E,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"mt-4 space-y-2 max-h-96 overflow-y-auto",children:[y?Array.from({length:5}).map((t,s)=>e.jsx("div",{className:"p-4 bg-graphite/30 rounded-xl animate-pulse border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-700 rounded w-24 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-700 rounded w-40 mb-1"}),e.jsx("div",{className:"h-3 bg-gray-700 rounded w-20"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-8 w-8 bg-gray-700 rounded-full"}),e.jsx("div",{className:"h-8 w-6 bg-gray-700 rounded"})]})]})},s)):C.length>0?C.map((t,s)=>{return e.jsx("div",{ref:s===C.length-1?_:null,className:"group p-4 bg-gradient-to-r from-graphite/30 to-graphite/20 rounded-xl hover:from-graphite/50 hover:to-graphite/40 transition-all duration-300 cursor-pointer border border-white/10 hover:border-indigo-400/30 hover:shadow-lg hover:shadow-indigo-500/10",onClick:()=>{return e=t.id,void a(`/view-session/${e}`);var e},children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs text-silver font-medium",children:D(t.created_at)}),t.completed_at&&e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-300 border border-green-400/30",children:"âœ“ Completed"})]}),t.session_name&&e.jsx("div",{className:"text-sm font-medium text-indigo-300 mb-2 line-clamp-1",children:t.session_name}),e.jsxs("div",{className:"flex items-center gap-3 text-xs mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-silver",children:[e.jsx("span",{children:"#"}),e.jsx("span",{children:t.id})]}),e.jsxs("div",{className:"flex items-center gap-1 text-silver",children:[e.jsx(M,{className:"w-3 h-3"}),e.jsx("span",{children:I(t.duration_sec)})]}),t.mood&&e.jsxs("div",{className:"flex items-center gap-1 text-silver",children:[e.jsx("span",{className:"text-sm",children:(n=t.mood,{calm:"ðŸ˜Œ",anxious:"ðŸ˜°",stressed:"ðŸ˜¤",focused:"ðŸŽ¯",tired:"ðŸ˜´",sad:"ðŸ˜¢",angry:"ðŸ˜ ",excited:"ðŸ¤©",confused:"ðŸ˜•",grateful:"ðŸ™",peaceful:"ðŸ•Šï¸",energetic:"âš¡",relaxed:"ðŸ§˜",overwhelmed:"ðŸ˜µ",hopeful:"ðŸŒŸ"}[n.toLowerCase()]||"ðŸ’­")}),e.jsx("span",{className:"capitalize",children:t.mood})]})]}),t.user_notes&&e.jsxs("div",{className:"mt-2 text-xs text-silver/80 line-clamp-2 italic",children:['"',t.user_notes,'"']})]}),e.jsx("div",{className:"flex items-center gap-2 ml-3",children:e.jsx("button",{onClick:e=>{e.stopPropagation(),(e=>{const t=`session-${e.id}`;if(u===e.id){const t=h.current.get(e.id);t&&(t.pause(),h.current.delete(e.id)),x(null)}else{r(t);const s=new Audio(e.audio_url);h.current.set(e.id,s),i(t,{current:s}),x(e.id),s.play().catch(t=>{x(null),h.current.delete(e.id)}),s.onended=()=>{x(null),h.current.delete(e.id)}}})(t)},className:"p-3 rounded-full transition-all duration-200 "+(u===t.id?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg":"bg-gradient-to-r from-indigo-500/20 to-purple-600/20 hover:from-indigo-500/30 hover:to-purple-600/30 text-indigo-300 hover:text-white border border-indigo-400/30"),"aria-label":u===t.id?"Pause":"Play",children:u===t.id?e.jsxs("div",{className:"w-5 h-5 flex items-center justify-center",children:[e.jsx("div",{className:"w-2 h-3 bg-current rounded-sm"}),e.jsx("div",{className:"w-2 h-3 bg-current rounded-sm ml-0.5"})]}):e.jsx("div",{className:"w-0 h-0 border-l-[8px] border-l-current border-y-[6px] border-y-transparent ml-1"})})})]})},t.id);var n}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsx(v,{className:"w-16 h-16 text-silver/60"})}),e.jsx("div",{className:"text-silver text-sm mb-2 font-medium",children:"No sessions found"}),e.jsx("div",{className:"text-silver/60 text-xs mb-4",children:l.search||"all"!==l.mood?"Try adjusting your filters or search terms":"Create your first session on the Home tab"}),l.search||"all"!==l.mood?e.jsx("button",{onClick:()=>d(e=>({...e,mood:"all",search:""})),className:"text-indigo-400 hover:text-indigo-300 text-xs underline",children:"Clear filters"}):null]}),j&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-silver text-sm",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-indigo-400"}),"Loading more sessions..."]})}),!f&&C.length>0&&e.jsx("div",{className:"text-center py-4 text-silver/60 text-xs",children:"You've reached the end of your sessions"})]})]})}function be(){const{userId:t}=I();return e.jsx("div",{children:e.jsxs("div",{className:"container-narrow grid-gap fadePop",children:[e.jsx(he,{userId:t||""}),e.jsx(pe,{userId:t||""})]})})}function fe(){const[t,s]=o.useState(!1),{data:a,isLoading:n,error:i}=$();o.useEffect(()=>{const e=setTimeout(()=>s(!0),100);return()=>clearTimeout(e)},[]);const r=a?.quote?.split("\n").filter(e=>e.trim())||[];return e.jsxs(X,{className:"relative overflow-hidden bg-gradient-to-br from-gray-900/50 via-black/30 to-gray-800/40 backdrop-blur-sm border-white/20",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-900/20 via-purple-900/10 to-slate-900/30"}),e.jsx("div",{className:"absolute top-4 left-6 text-sm animate-twinkle opacity-60",children:"âœ¨"}),e.jsx("div",{className:"absolute top-8 right-8 text-xs animate-twinkle opacity-40",style:{animationDelay:"1s"},children:"â­"}),e.jsx("div",{className:"absolute top-12 left-12 text-xs animate-twinkle opacity-50",style:{animationDelay:"2s"},children:"âœ¨"}),e.jsx("div",{className:"absolute top-16 right-16 text-sm animate-twinkle opacity-30",style:{animationDelay:"0.5s"},children:"â­"}),e.jsx("div",{className:"absolute top-20 left-8 text-xs animate-twinkle opacity-40",style:{animationDelay:"1.5s"},children:"âœ¨"}),e.jsx("div",{className:"absolute top-6 right-6 text-lg animate-gentle-bounce opacity-30",children:"ðŸŒ™"})]}),e.jsx("div",{className:"relative z-10 px-2 w-full",children:n?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-indigo-400 border-t-transparent rounded-full animate-spin"})}):i?e.jsx("div",{className:"text-white/60 text-sm text-center",children:"Unable to load inspirational quote"}):r.length>0?e.jsx("div",{className:"text-sm md:text-sm font-light text-white leading-relaxed transition-all duration-1000 text-center w-full "+(t?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),style:{transitionDelay:"0.2s"},children:r.map((t,s)=>e.jsx("div",{className:"block animate-gentle-float mb-2 w-full",style:{animationDelay:.5+.2*s+"s"},children:t.trim()},s))}):e.jsx("div",{className:"text-white/60 text-sm text-center",children:"Loading inspirational quote..."})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-500/5 via-purple-500/5 to-pink-500/5 animate-pulse-glow pointer-events-none"})]})}const ve={defaultTimeOptions:[{value:.5,label:"30s"},{value:1,label:"1m"},{value:2,label:"2m"}],meditation:{timeOptions:[{value:1,label:"1m"},{value:5,label:"5m"},{value:10,label:"10m"},{value:15,label:"15m"}],customRange:{min:.5,max:20,step:.5}},sleepStory:{timeOptions:[{value:1,label:"1m"},{value:5,label:"5m"},{value:10,label:"10m"},{value:15,label:"15m"},{value:25,label:"25m"}],customRange:{min:.5,max:60,step:.5}}};const je=(e,t)=>{if("undefined"==typeof window)return t;try{const s=localStorage.getItem(e);return s?JSON.parse(s):t}catch{return t}},ye=(e,t)=>{if("undefined"!=typeof window)try{localStorage.setItem(e,JSON.stringify(t))}catch{}},we=["calm","anxious","stressed","sleepy","grateful","sad","happy","angry","usual only","dont know"];function Ne({onSessionCreated:t,userId:s}){const[a,n]=o.useState(()=>je("ms.tab","meditation")),[i,r]=o.useState(()=>je("ms.mood","calm")),[l,d]=o.useState(()=>je("ms.customMood","")),[c,m]=o.useState(()=>je("ms.duration",5)),[u,x]=o.useState(()=>je("ms.customDuration",10)),[h,g]=o.useState(()=>je("ms.notes","")),[p,b]=o.useState("custom"===i),[f,v]=o.useState(!1),[j,y]=o.useState(""),[w,N]=o.useState(!1),k=P(),S=A();o.useEffect(()=>{ye("ms.tab",a)},[a]),o.useEffect(()=>{ye("ms.mood",i)},[i]),o.useEffect(()=>{ye("ms.customMood",l)},[l]),o.useEffect(()=>{ye("ms.duration",c)},[c]),o.useEffect(()=>{ye("ms.customDuration",u)},[u]),o.useEffect(()=>{ye("ms.notes",h)},[h]);const _=()=>{return ve["sleep_story"===(e=a)?"sleepStory":e].customRange;var e},C=async()=>{if(!k.isPending)try{y("Creating sessionâ€¦");const s=p?l:i,n=f?u:c,{session_id:r,status:o,generation_status:d}=await k.mutateAsync({kind:a,mood:s,duration:n,user_notes:h.trim()||void 0}),m={sessionId:r,status:o,generation_status:d};try{await S.mutateAsync({userId:""})}catch(e){}t(m),g(""),ye("ms.notes",""),y("")}catch(s){const e=s instanceof Error?s.message:String(s);e.includes("quota")||e.includes("503")?y("Session creation quota exceeded. Please try again later."):e.includes("timeout")?y("Request timed out. Please try again."):y("Session creation failed. Please try again.")}},D=p?l:i;return e.jsxs("div",{className:"grid-gap",children:[e.jsxs(X,{children:[e.jsx("div",{className:"heading bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent",children:"Start a session"}),e.jsxs("div",{className:"mt-4 flex bg-white/5 rounded-lg p-1",role:"tablist","aria-label":"Session type",children:[e.jsx("button",{onClick:()=>n("meditation"),className:"flex-1 px-3 py-2 rounded-md text-xs font-medium transition-all "+("meditation"===a?"bg-gradient-to-r from-indigo-500/20 to-purple-600/20 text-white border border-indigo-400/30":"text-white/70 hover:text-white"),role:"tab","aria-selected":"meditation"===a,"aria-controls":"meditation-panel",disabled:k.isPending,children:"Meditation"}),e.jsx("button",{onClick:()=>n("sleep_story"),className:"flex-1 px-3 py-2 rounded-md text-xs font-medium transition-all "+("sleep_story"===a?"bg-gradient-to-r from-indigo-500/20 to-purple-600/20 text-white border border-indigo-400/30":"text-white/70 hover:text-white"),role:"tab","aria-selected":"sleep_story"===a,"aria-controls":"sleep-story-panel",disabled:k.isPending,children:"Sleep Story"})]}),e.jsx("div",{className:"subtle mt-2 text-indigo-300",children:"Try to pinpoint your mood?"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",role:"radiogroup","aria-label":"Current mood",children:we.map(t=>e.jsx("button",{onClick:()=>{return r(e=t),b("custom"===e),void("custom"!==e&&d(""));var e},className:"px-3 py-1.5 rounded-xl border border-white/20 text-xs transition-all "+(i===t?"opacity-100 bg-gradient-to-r from-indigo-500/20 to-purple-600/20 border-indigo-400/50":"opacity-70 hover:opacity-90"),"aria-pressed":i===t,disabled:k.isPending,children:t},t))}),p&&e.jsx("input",{className:"mt-2 bg-graphite text-white border border-white/10 rounded-lg px-3 py-2 placeholder-silver/60 focus:outline-none focus:ring-2 focus:ring-white/10 w-full text-xs",value:l,onChange:e=>d(e.target.value),placeholder:"Enter your mood...","aria-label":"Custom mood",disabled:k.isPending}),e.jsx("div",{className:"subtle mt-3 text-indigo-300",children:"Select duration"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",role:"radiogroup","aria-label":"Session duration",children:ve["sleep_story"===(M=a)?"sleepStory":M].timeOptions.map(t=>e.jsx("button",{onClick:()=>{var e;"custom"===(e=t.value)?(v(!0),m(u)):(v(!1),m(e))},className:"px-3 py-1.5 rounded-xl border border-white/20 text-xs transition-all "+(f||c!==t.value?"opacity-70 hover:opacity-90":"opacity-100 bg-gradient-to-r from-indigo-500/20 to-purple-600/20 border-indigo-400/50"),"aria-pressed":!f&&c===t.value,disabled:k.isPending,children:t.label},t.value))}),f&&e.jsxs("div",{className:"mt-2",children:[e.jsx("input",{type:"range",min:_().min,max:_().max,step:_().step,value:u,onChange:e=>{return t=Number(e.target.value),x(t),void m(t);var t},className:"w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider","aria-label":"Custom duration in minutes",disabled:k.isPending}),e.jsxs("div",{className:"text-xs text-indigo-300 mt-1 text-center",children:["Selected: ",(E=u,E<1?`${Math.round(60*E)}s`:E===Math.floor(E)?`${Math.floor(E)}m`:`${E}m`)]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"subtle mb-2 text-indigo-300",children:"What's on your mind? How do you feel?"}),e.jsx(T,{value:h,onChange:g,disabled:k.isPending,placeholder:"",onRecordingStateChange:N,userId:s})]}),e.jsx("div",{className:"mt-6",children:e.jsx(J,{label:k.isPending?j||"Generatingâ€¦":"Generate & Play",onClick:C,disabled:k.isPending||!D.trim()||w,isLoading:k.isPending,variant:"white",size:"md",className:"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white border-0"})})]}),k.isError&&e.jsx(X,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"subtle",children:"Something went wrong. Check keys & network."}),e.jsx(J,{label:"Retry",onClick:()=>{C()},className:"ml-2 text-xs px-3 py-1"})]})})]});var E,M}const ke=new class{constructor(){this.session={sessionId:null,tracks:[],mood:"anxious",duration:5,createdAt:new Date},this.listeners=new Set}setSession(e,t,s,a){this.session={sessionId:e,tracks:t,mood:s,duration:a,createdAt:new Date},localStorage.setItem("currentSession",JSON.stringify(this.session)),this.listeners.forEach(e=>e())}getSession(){return this.session}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}clearSession(){this.session={sessionId:null,tracks:[],mood:"anxious",duration:5,createdAt:new Date},localStorage.removeItem("currentSession")}loadFromStorage(){const e=localStorage.getItem("currentSession");if(e)try{const t=JSON.parse(e);this.session={...t,createdAt:new Date(t.createdAt)}}catch(t){}}};function Se(){const{setSession:t}=function(){const[e,t]=d.useState(ke.getSession());return d.useEffect(()=>ke.subscribe(()=>{t(ke.getSession())}),[]),{session:e,setSession:ke.setSession.bind(ke),clearSession:ke.clearSession.bind(ke)}}(),{userId:s}=I(),a=m();return e.jsx("div",{className:"animate-fadeIn",children:e.jsxs("div",{className:"container-narrow grid-gap fadePop",children:[e.jsx(fe,{}),e.jsx(Ne,{onSessionCreated:e=>{t(e.sessionId,[],"calm",0),a(`/session/${e.sessionId}`)},userId:s||""})]})})}function _e({sessionId:t,audioUrl:s,durationSec:a,onEnded:n,sessionType:i="meditation",mood:r="calm",sessionName:l}){const o=c(),{playAudio:m,isPlaying:u}=se(),{playAudio:x,pauseAllExcept:h}=ne(),{globalVolume:g,setGlobalVolume:p}=se(),b=d.useRef(null),f=`session-player-${t}`,[v,j]=d.useState(!1),[y,w]=d.useState(!1),[N,E]=d.useState(0),[M,I]=d.useState(0),[$,P]=d.useState(g);ge({onHidden:()=>{b.current&&!b.current.paused&&(b.current.pause(),w(!1))},onVisible:()=>{}}),d.useEffect(()=>()=>{b.current&&!b.current.paused&&(b.current.pause(),w(!1))},[o.pathname]);const[A,T]=d.useState(1),[L,R]=d.useState(!1),[z,Y]=d.useState(0);d.useEffect(()=>{b.current||(b.current=new Audio);const e=b.current;e.volume=$,e.playbackRate=A;const t=()=>{E(Number.isFinite(e.duration)?e.duration:0),j(!0),e.play().catch(e=>{})},s=()=>{L||I(e.currentTime)},a=()=>w(!0),i=()=>w(!1),r=()=>{w(!1),n?.()},l=e=>{j(!1)};return e.addEventListener("loadedmetadata",t),e.addEventListener("timeupdate",s),e.addEventListener("play",a),e.addEventListener("pause",i),e.addEventListener("ended",r),e.addEventListener("error",l),()=>{e.removeEventListener("loadedmetadata",t),e.removeEventListener("timeupdate",s),e.removeEventListener("play",a),e.removeEventListener("pause",i),e.removeEventListener("ended",r),e.removeEventListener("error",l)}},[n,L,$,A]),d.useEffect(()=>{const e=b.current;j(!1),w(!1),I(0),E(0),e.src=s,e.load()},[s,a]),d.useEffect(()=>{u("session")?w(!0):u("ambient")&&w(!1)},[u]),d.useEffect(()=>()=>{b.current&&(b.current.pause(),b.current.currentTime=0)},[]);const O=()=>{R(!0),Y(M)},q=()=>{b.current.currentTime=z,I(z),R(!1)},V=e=>{if(!Number.isFinite(e)||e<=0)return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`},G=()=>N>0?M/N*100:0;return e.jsxs(X,{className:"overflow-hidden session-player",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-lg",children:"sleep_story"===i?"ðŸŒ™":"ðŸ§˜"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-white capitalize",children:l||`${i.replace("_"," ")} Session`}),e.jsx("div",{className:"text-sm text-gray-400 capitalize",children:r})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[e.jsx("span",{children:V(M)}),e.jsx("span",{children:V(N)})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"range",min:0,max:N||0,step:.1,value:L?z:M,onMouseDown:O,onTouchStart:O,onChange:e=>Y(parseFloat(e.target.value)),onMouseUp:q,onTouchEnd:q,"aria-label":"Seek",className:"w-full h-2 appearance-none bg-gray-700 rounded-full cursor-pointer",style:{background:`linear-gradient(to right, #6366f1 0%, #6366f1 ${G()}%, #374151 ${G()}%, #374151 100%)`}}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-2 flex justify-between items-center pointer-events-none",children:[...Array(10)].map((t,s)=>e.jsx("div",{className:"w-1 h-1 rounded-full "+(s/9*100<=G()?"bg-indigo-400":"bg-gray-600")},s))})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>{const e=b.current;e.currentTime=Math.max(0,e.currentTime-15),I(e.currentTime)},className:"w-10 h-10 rounded-full bg-gray-700 hover:bg-gray-600 flex items-center justify-center text-white transition-colors",disabled:!v,"aria-label":"Skip backward 15s",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{const e=b.current;e.paused?(h(f),m(e,"session"),x(f,b)):(e.pause(),w(!1))},className:"w-16 h-16 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 flex items-center justify-center text-white text-2xl transition-all transform hover:scale-105 active:scale-95",disabled:!v,"aria-label":y?"Pause":"Play",children:y?e.jsx(k,{className:"w-6 h-6"}):e.jsx(S,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>{const e=b.current;e.currentTime=Math.min(N,e.currentTime+15),I(e.currentTime)},className:"w-10 h-10 rounded-full bg-gray-700 hover:bg-gray-600 flex items-center justify-center text-white transition-colors",disabled:!v,"aria-label":"Skip forward 15s",children:e.jsx(S,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-400 w-16",children:"Volume"}),e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("div",{className:"text-gray-500",children:0===$?e.jsx(_,{className:"w-4 h-4"}):$>.7?e.jsx(C,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"})}),e.jsx("input",{type:"range",min:0,max:1,step:.1,value:$,onChange:e=>{return t=parseFloat(e.target.value),P(t),p(t),void(b.current&&(b.current.volume=t));var t},className:"flex-1 h-2 appearance-none bg-gray-700 rounded-full cursor-pointer slider",style:{background:`linear-gradient(to right, #6366f1 0%, #6366f1 ${100*$}%, #374151 ${100*$}%, #374151 100%)`}}),e.jsx("div",{className:"text-gray-500",children:0===$?e.jsx(_,{className:"w-4 h-4"}):$>.7?e.jsx(C,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"text-xs text-gray-400 w-8",children:[Math.round(100*$),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-400 w-16",children:"Speed"}),e.jsx("div",{className:"flex gap-1",children:[.7,.85,1,1.15,1.3].map(t=>e.jsxs("button",{onClick:()=>(e=>{T(e),b.current&&(b.current.playbackRate=e)})(t),className:"px-3 py-1 text-xs rounded-lg transition-colors "+(A===t?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:[t,"x"]},t))})]})]}),e.jsxs("div",{className:"mt-4 text-center",children:[!v&&e.jsxs("div",{className:"text-sm text-gray-400 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-pulse"}),"Loading audio..."]}),v&&!y&&e.jsx("div",{className:"text-sm text-gray-400",children:"Ready to play"}),y&&e.jsxs("div",{className:"text-sm text-indigo-400 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-pulse"}),"Now playing"]})]}),e.jsx("style",{dangerouslySetInnerHTML:{__html:'\n          .session-player input[type="range"]::-webkit-slider-thumb {\n            appearance: none;\n            width: 16px;\n            height: 16px;\n            border-radius: 50%;\n            background: #6366f1;\n            cursor: pointer;\n            border: 2px solid #1f2937;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n          }\n          .session-player input[type="range"]::-moz-range-thumb {\n            width: 16px;\n            height: 16px;\n            border-radius: 50%;\n            background: #6366f1;\n            cursor: pointer;\n            border: 2px solid #1f2937;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n          }\n        '}})]})}function Ce({isOpen:t,onClose:s,onSubmit:a,initialRating:n=0,initialFeedback:i="",userId:r}){const[l,d]=o.useState(n),[c,m]=o.useState(i),[u,x]=o.useState(!1);o.useEffect(()=>{t&&(d(n),m(i),x(!1))},[t,n,i]);const h=o.useMemo(()=>({ring:"ring-indigo-400/50",glow:"shadow-[0_0_0_1px_rgba(99,102,241,0.18),0_10px_30px_-10px_rgba(99,102,241,0.25)]",text:"text-indigo-300",dot:"bg-indigo-300/80",grad:"from-indigo-400/20 via-purple-300/10 to-purple-200/0"}),[]);return t?e.jsxs("div",{className:"fixed inset-0 z-[10000] flex items-end justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-[rgba(8,10,14,0.8)] backdrop-blur-xl",onClick:s}),e.jsx("div",{className:"pointer-events-none absolute top-0 left-0 right-0 h-28 bg-gradient-to-b from-white/6 via-white/3 to-transparent backdrop-blur-[12px]"}),u&&e.jsx(De,{accentClass:h.text}),e.jsxs("div",{className:["relative w-full max-w-md mx-4 rounded-t-[28px]","border border-white/10","bg-[rgba(20,22,28,0.2)] backdrop-blur-2xl","shadow-[0_20px_60px_-20px_rgba(0,0,0,0.65)]","overflow-hidden transform transition-transform duration-300 ease-out",h.glow].join(" "),style:{height:"75vh",minHeight:"75vh"},children:[e.jsx("div",{className:`pointer-events-none absolute inset-0 bg-gradient-to-br ${h.grad}`}),e.jsx("button",{onClick:s,className:"absolute top-4 right-4 z-20 grid place-content-center rounded-full bg-white/20 text-white/80 hover:text-white hover:bg-white/10 transition",style:{width:"24px",height:"24px"},"aria-label":"Close feedback modal",children:"âœ•"}),e.jsxs("div",{className:"relative z-10 h-full overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"px-6 pt-7 pb-4",children:[e.jsx("div",{className:"mx-auto mb-3 h-1.5 w-16 rounded-full bg-white/10"}),e.jsx("h2",{className:"text-xl font-semibold tracking-tight text-white text-center",children:"Wow! So glad you did it!"})]}),e.jsxs("div",{className:"px-6 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-white/90 mb-4",children:[e.jsx("span",{className:`${h.dot} inline-block h-1.5 w-1.5 rounded-full`}),e.jsx("span",{children:"How was the experience?"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:1,emoji:"ðŸ™",label:"Nothing Changed"},{value:2,emoji:"ðŸ™‚",label:"Little Bit Better"},{value:3,emoji:"ðŸ˜€",label:"I Feel Good Now"}].map(t=>{const s=l===t.value;return e.jsxs("button",{onClick:()=>d(t.value),className:["group relative overflow-hidden","rounded-2xl px-3 py-3 text-left","bg-white/[0.04] border border-white/10","hover:bg-white/[0.06] transition-all duration-200",s?`ring-2 ${h.ring} bg-white/[0.08]`:"ring-0"].join(" "),children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity bg-gradient-to-b from-white/5 to-transparent"}),e.jsx("div",{className:"text-2xl leading-none mb-2",children:t.emoji}),e.jsx("div",{className:`text-[13px] font-semibold ${s?h.text:"text-white/90"}`,children:t.label})]},t.value)})})]}),e.jsxs("div",{className:"px-6 pt-4 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-white/90 mb-3",children:[e.jsx("span",{className:`${h.dot} inline-block h-1.5 w-1.5 rounded-full`}),e.jsx("span",{children:"How can we improve?"})]}),e.jsx("div",{className:["rounded-2xl border border-white/10 bg-white/[0.04]","focus-within:border-white/20 focus-within:bg-white/[0.06] transition-colors"].join(" "),children:e.jsx(T,{value:c,onChange:m,placeholder:"",disabled:!1,userId:r})})]}),e.jsxs("div",{className:"px-6 pb-7",children:[e.jsx("button",{onClick:()=>{l>0&&(a({rating:l,text:c}),x(!0),setTimeout(()=>{x(!1),s()},2800))},disabled:0===l,className:["w-full py-3.5 px-6 rounded-2xl font-semibold","transition-all duration-200","bg-white text-gray-900 hover:bg-gray-100 active:scale-[0.98]",0===l&&"opacity-40 cursor-not-allowed"].join(" "),children:"Submit Session Feedback"}),e.jsx("p",{className:"mt-3 text-center text-[11px] text-white/45",children:"Thank you for helping us improve."})]})]})]}),e.jsx("style",{children:"\n        .custom-scrollbar::-webkit-scrollbar {\n          width: 10px;\n        }\n        .custom-scrollbar::-webkit-scrollbar-thumb {\n          background: rgba(255, 255, 255, 0.12);\n          border-radius: 8px;\n        }\n        .custom-scrollbar::-webkit-scrollbar-track {\n          background: transparent;\n        }\n      "})]}):null}function De({accentClass:t="text-indigo-300"}){const s=new Array(18).fill(0).map((e,t)=>t);return e.jsxs("div",{className:"pointer-events-none absolute inset-0 z-[10001] overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-white/3 to-transparent backdrop-blur-[2px]"}),e.jsx("div",{className:"absolute inset-0 grid place-items-center",children:e.jsx("div",{className:"animate-trophy-scale",children:e.jsx("svg",{width:"96",height:"96",viewBox:"0 0 24 24",className:`${t} drop-shadow-[0_6px_24px_rgba(99,102,241,0.45)]`,fill:"currentColor",children:e.jsx("path",{d:"M19 5h-2V4a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v1H5a1 1 0 0 0-1 1v1a5 5 0 0 0 4 4.9V13a3 3 0 0 0 2 2.83V18H7a1 1 0 1 0 0 2h10a1 1 0 1 0 0-2h-3v-2.17A3 3 0 0 0 16 13v-1.1A5 5 0 0 0 20 7V6a1 1 0 0 0-1-1Zm-2 3.9a3.01 3.01 0 0 1-2 2.82V13a1 1 0 1 1-2 0v-1.28A3.01 3.01 0 0 1 9 8.9V6h6v2.9ZM6 6v1a3 3 0 0 0 2 2.82V6H6Zm12 0h-2v3.82A3 3 0 0 0 18 7V6Z"})})})}),s.map(t=>e.jsx("span",{className:"absolute w-2 h-3 rounded-[2px] opacity-90 animate-confetti",style:{left:53*t%100+"%",top:`-${20*Math.random()+5}%`,background:["#6366f1","#a855f7","#FFFFFF","#8b5cf6"][t%4],transform:`rotate(${360*Math.random()}deg)`,animationDelay:t%12*.07+"s",animationDuration:2+t%6*.18+"s"}},t)),e.jsx("style",{children:"\n        @keyframes confetti-fall {\n          0% {\n            transform: translateY(-10vh) rotate(0deg);\n            opacity: 0;\n          }\n          10% {\n            opacity: 1;\n          }\n          100% {\n            transform: translateY(110vh) rotate(360deg);\n            opacity: 0;\n          }\n        }\n        .animate-confetti {\n          animation-name: confetti-fall;\n          animation-timing-function: cubic-bezier(0.2, 0.6, 0.2, 1);\n          animation-fill-mode: both;\n        }\n        @keyframes trophy-scale {\n          0% {\n            transform: scale(0.6);\n            opacity: 0;\n          }\n          20% {\n            transform: scale(1.08);\n            opacity: 1;\n          }\n          60% {\n            transform: scale(1);\n          }\n          100% {\n            transform: scale(1);\n            opacity: 1;\n          }\n        }\n        .animate-trophy-scale {\n          animation: trophy-scale 800ms ease-out forwards;\n          filter: drop-shadow(0 12px 40px rgba(99, 102, 241, 0.35));\n        }\n      "})]})}function Ee({kind:t}){const[s,a]=o.useState(0),[n,i]=o.useState([]),r="meditation"===t?[{text:"Preparing your sacred space...",icon:"ðŸ§˜",color:"from-indigo-500 to-purple-600"},{text:"Crafting personalized guidance...",icon:"âœ¨",color:"from-purple-500 to-blue-600"},{text:"Weaving words of wisdom...",icon:"ðŸŒ™",color:"from-blue-500 to-cyan-600"},{text:"Infusing with calming energy...",icon:"ðŸŒ¸",color:"from-cyan-500 to-indigo-600"},{text:"Generating serene audio...",icon:e.jsx(N,{className:"w-5 h-5"}),color:"from-indigo-500 to-purple-600"},{text:"Almost ready to begin...",icon:"ðŸŒŸ",color:"from-purple-500 to-blue-600"}]:[{text:"Gathering dreamy elements...",icon:"ðŸŒ™",color:"from-indigo-500 to-purple-600"},{text:"Painting peaceful scenes...",icon:"ðŸŽ¨",color:"from-purple-500 to-blue-600"},{text:"Whispering gentle words...",icon:"ðŸ’«",color:"from-blue-500 to-cyan-600"},{text:"Creating cozy atmosphere...",icon:e.jsx(v,{className:"w-5 h-5"}),color:"from-cyan-500 to-indigo-600"},{text:"Weaving lullaby melodies...",icon:"ðŸŽ¶",color:"from-indigo-500 to-purple-600"},{text:"Ready for sweet dreams...",icon:"âœ¨",color:"from-purple-500 to-blue-600"}];o.useEffect(()=>{const e=setInterval(()=>{a(e=>(e+1)%r.length)},2e3);return()=>clearInterval(e)},[r.length]),o.useEffect(()=>{const e=()=>{const e=Array.from({length:8},(e,t)=>({id:t,x:100*Math.random(),y:100*Math.random(),delay:2*Math.random()}));i(e)};e();const t=setInterval(e,3e3);return()=>clearInterval(t)},[]);const l=r[s];return e.jsxs("div",{className:"relative min-h-[400px] flex items-center justify-center overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-br from-slate-900 via-indigo-900 to-purple-900",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_30%_20%,rgba(99,102,241,0.3),transparent_50%)]"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_70%_80%,rgba(147,51,234,0.2),transparent_50%)]"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(59,130,246,0.1),transparent_50%)]"})]}),e.jsx("div",{className:"absolute top-6 right-6 text-3xl animate-gentle-bounce",children:"sleep_story"===t?"ðŸŒ™":"â˜€ï¸"}),e.jsx("div",{className:"absolute top-12 left-8 text-lg animate-twinkle",style:{animationDelay:"0s"},children:"â­"}),e.jsx("div",{className:"absolute top-16 right-12 text-sm animate-twinkle",style:{animationDelay:"1s"},children:"âœ¨"}),e.jsx("div",{className:"absolute top-24 left-12 text-sm animate-twinkle",style:{animationDelay:"2s"},children:"â­"}),e.jsx("div",{className:"absolute top-20 right-16 text-lg animate-twinkle",style:{animationDelay:"0.5s"},children:"âœ¨"}),e.jsx("div",{className:"absolute top-32 left-16 text-sm animate-twinkle",style:{animationDelay:"1.5s"},children:"â­"}),e.jsx("div",{className:"absolute top-28 right-20 text-sm animate-twinkle",style:{animationDelay:"2.5s"},children:"âœ¨"}),n.map(t=>e.jsx("div",{className:"absolute w-2 h-2 bg-white/20 rounded-full animate-pulse",style:{left:`${t.x}%`,top:`${t.y}%`,animationDelay:`${t.delay}s`,animation:`float-particle 4s ease-in-out infinite ${t.delay}s`}},t.id)),e.jsxs("div",{className:"relative z-10 text-center space-y-8",children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"w-24 h-24 mx-auto mb-6 relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-r from-white/20 to-transparent animate-spin",style:{animationDuration:"8s"}}),e.jsx("div",{className:"absolute inset-2 rounded-full border-2 border-white/30 animate-pulse"}),e.jsx("div",{className:"absolute inset-4 rounded-full bg-gradient-to-r from-white/10 to-transparent animate-spin",style:{animationDuration:"6s",animationDirection:"reverse"}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-4xl animate-bounce",children:l.icon})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-2xl font-light text-white/90 mb-2",children:l.text}),e.jsx("div",{className:"w-64 mx-auto",children:e.jsx("div",{className:"h-1 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full bg-gradient-to-r ${l.color} rounded-full transition-all duration-1000 ease-out`,style:{width:(s+1)/r.length*100+"%"}})})}),e.jsx("div",{className:"flex justify-center space-x-2",children:r.map((t,a)=>e.jsx("div",{className:"w-2 h-2 rounded-full transition-all duration-500 "+(a<=s?`bg-gradient-to-r ${l.color}`:"bg-white/20")},a))})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"flex space-x-1",children:[0,1,2].map(t=>e.jsx("div",{className:"w-1 h-8 bg-white/30 rounded-full animate-pulse",style:{animationDelay:.2*t+"s",animation:`breathe 2s ease-in-out infinite ${.2*t}s`}},t))})}),e.jsx("div",{style:{maxWidth:"300px"},className:"text-center",children:e.jsx("p",{className:"text-sm text-white/60 italic leading-relaxed",children:"meditation"===t?"In the silence between thoughts, we find our true self.":"Dreams are the whispers of the soul, heard in the quiet of night."})})]}),e.jsx("style",{dangerouslySetInnerHTML:{__html:"\n          @keyframes float-particle {\n            0%, 100% {\n              transform: translateY(0px) scale(1);\n              opacity: 0.2;\n            }\n            50% {\n              transform: translateY(-20px) scale(1.2);\n              opacity: 0.6;\n            }\n          }\n\n          @keyframes breathe {\n            0%, 100% {\n              transform: scaleY(1);\n              opacity: 0.3;\n            }\n            50% {\n              transform: scaleY(2);\n              opacity: 0.8;\n            }\n          }\n\n          @keyframes gentle-bounce {\n            0%, 100% {\n              transform: translateY(0px) scale(1);\n            }\n            50% {\n              transform: translateY(-3px) scale(1.05);\n            }\n          }\n\n          @keyframes twinkle {\n            0%, 100% {\n              opacity: 0.3;\n              transform: scale(1);\n            }\n            50% {\n              opacity: 1;\n              transform: scale(1.2);\n            }\n          }\n\n          .animate-gentle-bounce {\n            animation: gentle-bounce 2s ease-in-out infinite;\n          }\n\n          .animate-twinkle {\n            animation: twinkle 2s ease-in-out infinite;\n          }\n        "}})]})}function Me({kind:t="meditation"}){const[s,a]=o.useState([]),[n,i]=o.useState(0);o.useEffect(()=>{const e=()=>{const e=Array.from({length:12},(e,t)=>({id:t,x:100*Math.random(),y:100*Math.random(),size:4*Math.random()+2,delay:4*Math.random(),duration:8*Math.random()+6}));a(e)};e();const t=setInterval(e,8e3);return()=>clearInterval(t)},[]),o.useEffect(()=>{const e=setInterval(()=>{i(e=>(e+1)%4)},3e3);return()=>clearInterval(e)},[]);const r=()=>{switch(n){case 0:default:return"opacity-60";case 1:case 3:return"opacity-80";case 2:return"opacity-100"}},l={primary:"from-indigo-400/30 to-purple-500/30",secondary:"from-purple-400/20 to-blue-500/20",accent:"from-blue-400/10 to-cyan-500/10",particles:"bg-indigo-300/40",glow:"shadow-indigo-500/20",sun:"text-yellow-300/60",moon:"text-blue-200/70",stars:"text-white/50"};return e.jsxs("div",{className:"relative w-full overflow-hidden rounded-xl",style:{height:"200px"},children:[e.jsxs("div",{className:`absolute inset-0 bg-gradient-to-br ${l.primary} rounded-xl`,children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-tr ${l.secondary} rounded-xl`}),e.jsx("div",{className:`absolute inset-0 bg-gradient-to-bl ${l.accent} rounded-xl`})]}),e.jsx("div",{className:"absolute top-4 right-4 text-2xl animate-gentle-bounce",children:"sleep_story"===t?"ðŸŒ™":"â˜€ï¸"}),e.jsx("div",{className:"absolute top-8 left-6 text-sm animate-twinkle",style:{animationDelay:"0s"},children:"â­"}),e.jsx("div",{className:"absolute top-12 right-8 text-xs animate-twinkle",style:{animationDelay:"1s"},children:"âœ¨"}),e.jsx("div",{className:"absolute top-20 left-8 text-xs animate-twinkle",style:{animationDelay:"2s"},children:"â­"}),e.jsx("div",{className:"absolute top-16 right-12 text-sm animate-twinkle",style:{animationDelay:"0.5s"},children:"âœ¨"}),e.jsx("div",{className:"absolute top-6 left-1/2 transform -translate-x-1/2",children:e.jsxs("div",{className:`relative transition-all duration-3000 ease-in-out ${(()=>{switch(n){case 0:default:return"scale-100";case 1:case 3:return"scale-110";case 2:return"scale-120"}})()}`,children:[e.jsx("div",{className:`absolute inset-0 w-20 h-20 rounded-full bg-gradient-to-r ${l.primary} ${r()} transition-all duration-3000 ease-in-out`,style:{boxShadow:"0 0 25px rgba(59, 130, 246, 0.4)",animation:"pulse 4s ease-in-out infinite"}}),e.jsx("div",{className:`w-20 h-20 rounded-full bg-gradient-to-r ${l.secondary} ${r()} transition-all duration-3000 ease-in-out`,style:{boxShadow:"0 0 20px rgba(16, 185, 129, 0.3)",animation:"breathe 6s ease-in-out infinite"}}),e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-blue-400/40 rounded-full animate-float-orb",style:{animationDelay:"0s"}}),e.jsx("div",{className:"absolute -bottom-1 -left-1 w-2 h-2 bg-purple-400/40 rounded-full animate-float-orb",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute -top-0.5 -left-0.5 w-1.5 h-1.5 bg-pink-400/40 rounded-full animate-float-orb",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-3xl opacity-90 animate-gentle-bounce",children:"sleep_story"===t?"ðŸŒ™":"ðŸ§˜"})]})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pt-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-light text-white/80 mb-2 animate-fade-in",children:"sleep_story"===t?"Drift into peaceful dreams...":"Breathe deeply and relax..."}),e.jsx("div",{className:"text-sm text-white/60 animate-fade-in-slow",children:"sleep_story"===t?"Let the story guide you to sleep":"Find your inner calm"})]})}),s.map(t=>e.jsx("div",{className:`absolute ${l.particles} rounded-full ${l.glow}`,style:{left:`${t.x}%`,top:`${t.y}%`,width:`${t.size}px`,height:`${t.size}px`,animation:`float-gentle ${t.duration}s ease-in-out infinite ${t.delay}s`}},t.id)),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-8 overflow-hidden",children:[...Array(3)].map((t,s)=>e.jsx("div",{className:`absolute w-full h-full bg-gradient-to-r ${l.primary} opacity-30`,style:{animation:`wave-gentle ${8+2*s}s ease-in-out infinite ${1.5*s}s`,transform:`translateY(${8*s}px)`}},s))}),e.jsx("style",{children:"\n        @keyframes float-gentle {\n          0%, 100% {\n            transform: translateY(0px) translateX(0px) scale(1);\n            opacity: 0.3;\n          }\n          25% {\n            transform: translateY(-15px) translateX(5px) scale(1.1);\n            opacity: 0.6;\n          }\n          50% {\n            transform: translateY(-25px) translateX(-3px) scale(0.9);\n            opacity: 0.8;\n          }\n          75% {\n            transform: translateY(-10px) translateX(8px) scale(1.05);\n            opacity: 0.5;\n          }\n        }\n\n        @keyframes breathe {\n          0%, 100% {\n            transform: scale(1);\n            opacity: 0.6;\n          }\n          50% {\n            transform: scale(1.2);\n            opacity: 1;\n          }\n        }\n\n        @keyframes wave-gentle {\n          0%, 100% {\n            transform: translateX(-100%) scaleY(1);\n            opacity: 0.3;\n          }\n          50% {\n            transform: translateX(0%) scaleY(1.2);\n            opacity: 0.6;\n          }\n        }\n\n        @keyframes float-orb {\n          0%, 100% {\n            transform: translateY(0px) scale(1);\n            opacity: 0.4;\n          }\n          50% {\n            transform: translateY(-8px) scale(1.2);\n            opacity: 0.8;\n          }\n        }\n\n        @keyframes gentle-bounce {\n          0%, 100% {\n            transform: translateY(0px) scale(1);\n          }\n          50% {\n            transform: translateY(-3px) scale(1.05);\n          }\n        }\n\n        @keyframes fade-in {\n          0% {\n            opacity: 0;\n            transform: translateY(10px);\n          }\n          100% {\n            opacity: 1;\n            transform: translateY(0px);\n          }\n        }\n\n        @keyframes fade-in-slow {\n          0% {\n            opacity: 0;\n            transform: translateY(5px);\n          }\n          100% {\n            opacity: 1;\n            transform: translateY(0px);\n          }\n        }\n\n        @keyframes twinkle {\n          0%, 100% {\n            opacity: 0.3;\n            transform: scale(1);\n          }\n          50% {\n            opacity: 1;\n            transform: scale(1.2);\n          }\n        }\n\n        .animate-float-orb {\n          animation: float-orb 3s ease-in-out infinite;\n        }\n\n        .animate-gentle-bounce {\n          animation: gentle-bounce 2s ease-in-out infinite;\n        }\n\n        .animate-fade-in {\n          animation: fade-in 1s ease-out;\n        }\n\n        .animate-fade-in-slow {\n          animation: fade-in-slow 2s ease-out;\n        }\n\n        .animate-twinkle {\n          animation: twinkle 2s ease-in-out infinite;\n        }\n      "})]})}function Ie(){const{sessionId:t}=u(),{userId:s}=I(),a=m(),[n,i]=o.useState(null),[r,l]=o.useState(!0),[d,c]=o.useState(null),[x,h]=o.useState(!1),[g,p]=o.useState(!1),[b,f]=o.useState(!1),[v,j]=o.useState("Initializing..."),[y,w]=o.useState(""),N=o.useRef(!1),k=o.useRef(new Set),S=L(),_=R();o.useEffect(()=>{t&&C()},[t]),o.useEffect(()=>()=>{document.querySelectorAll("audio").forEach(e=>{e.pause(),e.currentTime=0})},[]);const C=async()=>{try{l(!0);const{api:e}=await U(async()=>{const{api:e}=await import("./voice-features-BuzIv5ek.js").then(e=>e.y);return{api:e}},__vite__mapDeps([0,1,2,3,4])),s=(await e.get(`/session/${t}`)).data;i(s),s.script||k.current.has(t)?s.audio_url||!s.script||k.current.has(t)?j("Ready to play"):(k.current.add(t),N.current=!0,await E()):(k.current.add(t),N.current=!0,await D())}catch(e){c(e instanceof Error?e.message:"Failed to load session")}finally{l(!1)}},D=async()=>{if(!b)try{f(!0),j("Generating session name...");const e=await S.mutateAsync({sessionId:t});i(t=>t?{...t,script:e.script_content,session_name:e.session_name||`${t.kind.replace("_"," ")} Session`}:null),e.session_name&&w(e.session_name),j("Generating audio...");const s=await _.mutateAsync({sessionId:t});i(e=>e?{...e,audio_url:s.audio_url,duration_sec:s.duration_sec}:null),j("Ready to play")}catch(e){c(e instanceof Error?e.message:"Failed to generate content")}finally{f(!1)}},E=async()=>{if(!b)try{f(!0),j("Generating audio...");const e=await _.mutateAsync({sessionId:t});i(t=>t?{...t,audio_url:e.audio_url,duration_sec:e.duration_sec}:null),j("Ready to play")}catch(e){c(e instanceof Error?e.message:"Failed to generate audio")}finally{f(!1)}};return e.jsx("div",{className:"min-h-screen",children:e.jsxs("div",{className:"container-narrow grid-gap fadePop",children:[e.jsx(X,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>{a("/")},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors duration-200",children:"â† Back"}),e.jsx("div",{className:"text-right",children:r?e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-700 rounded w-24 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded w-32"})]}):d?e.jsx("div",{className:"text-red-500",children:"Error loading session"}):b?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-300 mb-2",children:v}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("div",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]}):n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xl font-semibold text-white capitalize",children:n.kind.replace("_"," ")}),e.jsx("div",{className:"text-gray-400",children:n.session_name||`${n.kind.replace("_"," ")} Session`})]}):b&&y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xl font-semibold text-white capitalize",children:"meditation"}),e.jsx("div",{className:"text-gray-400",children:y})]}):e.jsx("div",{className:"text-gray-400",children:"Session not found"})})]})}),e.jsx(X,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-400",children:"Session"}),r?e.jsx("div",{className:"animate-pulse h-4 bg-gray-700 rounded w-16"}):n?e.jsxs("div",{className:"text-white",children:["#",n.id]}):e.jsx("div",{className:"text-gray-500",children:"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-400",children:"Duration"}),r?e.jsx("div",{className:"animate-pulse h-4 bg-gray-700 rounded w-16"}):n?e.jsxs("div",{className:"text-white",children:[n.duration," min"]}):e.jsx("div",{className:"text-gray-500",children:"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-400",children:"Mood"}),r?e.jsx("div",{className:"animate-pulse h-4 bg-gray-700 rounded w-20"}):n?e.jsx("div",{className:"text-white capitalize",children:n.mood}):e.jsx("div",{className:"text-gray-500",children:"-"})]})]}),n?.user_notes&&e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"font-medium text-gray-400 mb-2",children:"Notes"}),e.jsx("div",{className:"text-white text-sm bg-gray-800/50 rounded-lg p-3",children:n.user_notes})]})]})}),r||b?e.jsx(X,{className:"overflow-hidden p-0",children:e.jsx(Ee,{status:v,kind:n?.kind||"meditation"})}):n&&n.audio_url?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"overflow-hidden p-0",children:e.jsx(Me,{kind:n?.kind||"meditation"})}),e.jsx(_e,{sessionId:t,audioUrl:n.audio_url,durationSec:n.duration_sec||0,onEnded:()=>{g||(h(!0),p(!0))},sessionType:n.kind,mood:n.mood,sessionName:n.session_name})]}):e.jsx(X,{children:e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Audio not available"})}),e.jsx(Ce,{isOpen:x,onClose:()=>{h(!1)},onSubmit:async e=>{try{const{api:s}=await U(async()=>{const{api:e}=await import("./voice-features-BuzIv5ek.js").then(e=>e.y);return{api:e}},__vite__mapDeps([0,1,2,3,4]));await s.post(`/session/${t}/feedback`,{post_rating:e.rating,post_feedback:e.text});i(t=>t?{...t,post_rating:e.rating,post_feedback:e.text,completed_at:(new Date).toISOString()}:null),a("/")}catch(s){a("/")}},initialRating:n?.post_rating,initialFeedback:n?.post_feedback,userId:s||""}),d&&e.jsx(X,{children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsxs("div",{className:"mb-2",children:["Error: ",d]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors duration-200",children:"Retry"})]})})]})})}function $e(){const{sessionId:t}=u(),s=m(),[a,n]=o.useState(null),[i,r]=o.useState(!0),[l,d]=o.useState(null),[c,x]=o.useState(!1),[h,g]=o.useState("Initializing..."),[p,b]=o.useState(""),f=o.useRef(!1),v=o.useRef(new Set),j=L(),y=R();o.useEffect(()=>{t&&w()},[t]);const w=async()=>{try{r(!0);const{api:e}=await U(async()=>{const{api:e}=await import("./voice-features-BuzIv5ek.js").then(e=>e.y);return{api:e}},__vite__mapDeps([0,1,2,3,4])),s=(await e.get(`/session/${t}`)).data;n(s),s.script||v.current.has(t)?s.audio_url||!s.script||v.current.has(t)?g("Ready to play"):(v.current.add(t),f.current=!0,await k()):(v.current.add(t),f.current=!0,await N())}catch(e){d(e instanceof Error?e.message:"Failed to load session")}finally{r(!1)}},N=async()=>{if(!c)try{x(!0),g("Generating session name...");const e=await j.mutateAsync({sessionId:t});n(t=>t?{...t,script:e.script_content,session_name:e.session_name||`${t.kind.replace("_"," ")} Session`}:null),e.session_name&&b(e.session_name),g("Generating audio...");const s=await y.mutateAsync({sessionId:t});n(e=>e?{...e,audio_url:s.audio_url,duration_sec:s.duration_sec}:null),g("Ready to play")}catch(e){d(e instanceof Error?e.message:"Failed to generate content")}finally{x(!1)}},k=async()=>{if(!c)try{x(!0),g("Generating audio...");const e=await y.mutateAsync({sessionId:t});n(t=>t?{...t,audio_url:e.audio_url,duration_sec:e.duration_sec}:null),g("Ready to play")}catch(e){d(e instanceof Error?e.message:"Failed to generate audio")}finally{x(!1)}};return e.jsx("div",{className:"min-h-screen",children:e.jsxs("div",{className:"container-narrow grid-gap fadePop",children:[e.jsx(X,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>{s("/")},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors duration-200",children:"â† Back"}),e.jsx("div",{className:"text-right",children:i?e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-700 rounded w-24 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded w-32"})]}):l?e.jsx("div",{className:"text-red-500",children:"Error loading session"}):c?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-300 mb-2",children:h}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("div",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]}):a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xl font-semibold text-white capitalize",children:a.kind.replace("_"," ")}),e.jsx("div",{className:"text-gray-400",children:a.session_name||`${a.kind.replace("_"," ")} Session`})]}):c&&p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xl font-semibold text-white capitalize",children:"meditation"}),e.jsx("div",{className:"text-gray-400",children:p})]}):e.jsx("div",{className:"text-gray-400",children:"Session not found"})})]})}),e.jsx(X,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-400",children:"Session"}),i?e.jsx("div",{className:"animate-pulse h-4 bg-gray-700 rounded w-16"}):a?e.jsxs("div",{className:"text-white",children:["#",a.id]}):e.jsx("div",{className:"text-gray-500",children:"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-400",children:"Duration"}),i?e.jsx("div",{className:"animate-pulse h-4 bg-gray-700 rounded w-16"}):a?e.jsxs("div",{className:"text-white",children:[a.duration," min"]}):e.jsx("div",{className:"text-gray-500",children:"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-400",children:"Mood"}),i?e.jsx("div",{className:"animate-pulse h-4 bg-gray-700 rounded w-20"}):a?e.jsx("div",{className:"text-white capitalize",children:a.mood}):e.jsx("div",{className:"text-gray-500",children:"-"})]})]}),a?.user_notes&&e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"font-medium text-gray-400 mb-2",children:"Notes"}),e.jsx("div",{className:"text-white text-sm bg-gray-800/50 rounded-lg p-3",children:a.user_notes})]})]})}),i||c?e.jsx(X,{className:"overflow-hidden p-0",children:e.jsx(Ee,{status:h,kind:a?.kind||"meditation"})}):a&&a.audio_url?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"overflow-hidden p-0",children:e.jsx(Me,{kind:a?.kind||"meditation"})}),e.jsx(_e,{sessionId:t,audioUrl:a.audio_url,durationSec:a.duration_sec||0,onEnded:()=>{},sessionType:a.kind,mood:a.mood,sessionName:a.session_name})]}):e.jsx(X,{children:e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Audio not available"})}),e.jsx(X,{children:e.jsxs("div",{className:"text-center text-gray-400 text-sm",children:[e.jsx("div",{className:"mb-2",children:"ðŸ“– View Only Mode"}),e.jsx("div",{children:"This session is read-only. No editing or generation controls available."})]})}),l&&e.jsx(X,{children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsxs("div",{className:"mb-2",children:["Error: ",l]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors duration-200",children:"Retry"})]})})]})})}function Pe({isOpen:t,onClose:s}){return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 transition-opacity duration-300",onClick:s}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50 transform transition-transform duration-300 ease-out",children:e.jsx("div",{className:"mx-4 mb-4",children:e.jsxs(X,{className:"max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Privacy Policy"}),e.jsx("button",{onClick:s,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10 transition-colors",children:e.jsx("span",{className:"text-white/60 text-xl",children:"Ã—"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:e.jsxs("div",{className:"space-y-6 text-white/80",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Introduction"}),e.jsx("p",{className:"text-sm leading-relaxed",children:"At MindSphere, we are committed to protecting your privacy and ensuring the security of your personal information. This Privacy Policy explains how we collect, use, and safeguard your data when you use our meditation and sleep story application."})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Information We Collect"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-medium text-white/90 mb-2",children:"Personal Information"}),e.jsxs("ul",{className:"text-sm space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ Name and email address (from Google OAuth)"}),e.jsx("li",{children:"â€¢ Profile picture (from Google OAuth)"}),e.jsx("li",{children:"â€¢ Meditation session data and preferences"}),e.jsx("li",{children:"â€¢ Sleep story listening history"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-medium text-white/90 mb-2",children:"Usage Data"}),e.jsxs("ul",{className:"text-sm space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ Session duration and completion rates"}),e.jsx("li",{children:"â€¢ Feature usage patterns"}),e.jsx("li",{children:"â€¢ Device information and app performance"})]})]})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"How We Use Your Information"}),e.jsxs("ul",{className:"text-sm space-y-2 ml-4",children:[e.jsx("li",{children:"â€¢ To provide personalized meditation and sleep content"}),e.jsx("li",{children:"â€¢ To track your progress and streaks"}),e.jsx("li",{children:"â€¢ To improve our services and user experience"}),e.jsx("li",{children:"â€¢ To send you relevant notifications and updates"}),e.jsx("li",{children:"â€¢ To analyze usage patterns for app optimization"})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Data Security"}),e.jsx("p",{className:"text-sm leading-relaxed",children:"We implement industry-standard security measures to protect your personal information. All data is encrypted in transit and at rest. We use secure authentication through Google OAuth and do not store your Google credentials."})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Third-Party Services"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm leading-relaxed",children:"We use the following third-party services:"}),e.jsxs("ul",{className:"text-sm space-y-1 ml-4",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Google OAuth:"})," For secure authentication"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Supabase:"})," For database and authentication services"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Railway:"})," For application hosting"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Vercel:"})," For frontend hosting"]})]})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Your Rights"}),e.jsxs("ul",{className:"text-sm space-y-2 ml-4",children:[e.jsx("li",{children:"â€¢ Access your personal data"}),e.jsx("li",{children:"â€¢ Request correction of inaccurate data"}),e.jsx("li",{children:"â€¢ Request deletion of your data"}),e.jsx("li",{children:"â€¢ Opt-out of data processing"}),e.jsx("li",{children:"â€¢ Export your data in a portable format"})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Data Retention"}),e.jsx("p",{className:"text-sm leading-relaxed",children:"We retain your personal information for as long as your account is active or as needed to provide services. You can request deletion of your account and associated data at any time."})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Contact Us"}),e.jsx("p",{className:"text-sm leading-relaxed",children:"If you have any questions about this Privacy Policy or our data practices, please contact us at:"}),e.jsxs("div",{className:"mt-2 p-3 bg-white/5 rounded-lg",children:[e.jsx("p",{className:"text-sm text-white/90",children:"Email: privacy@mindsphere.app"}),e.jsx("p",{className:"text-sm text-white/90",children:"Last updated: September 25, 2025"})]})]})]})}),e.jsx("div",{className:"p-6 border-t border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-white/50",children:"By using MindSphere, you agree to this Privacy Policy"}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white text-sm font-medium rounded-lg hover:from-indigo-600 hover:to-purple-700 transition-all duration-200",children:"Close"})]})})]})})})]}):null}function Ae(){const[t,s]=o.useState(!1),[a,n]=o.useState(null),[i,r]=o.useState(!1),[l,d]=o.useState(!1),c="google"===z;return e.jsxs("div",{className:"min-h-screen relative overflow-hidden bg-gradient-to-br from-gray-900 via-black to-gray-800",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-gradient-to-r from-white/5 to-white/10 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute top-3/4 right-1/4 w-48 h-48 bg-gradient-to-r from-white/3 to-white/8 rounded-full blur-2xl animate-pulse delay-1000"}),e.jsx("div",{className:"absolute bottom-1/4 left-1/3 w-32 h-32 bg-gradient-to-r from-white/4 to-white/6 rounded-full blur-xl animate-pulse delay-500"}),e.jsx("div",{className:"absolute top-1/6 left-1/6 w-2 h-2 bg-white/20 rounded-full animate-float-slow"}),e.jsx("div",{className:"absolute top-1/3 right-1/5 w-1 h-1 bg-white/30 rounded-full animate-float-slow delay-1000"}),e.jsx("div",{className:"absolute top-2/3 left-1/5 w-1.5 h-1.5 bg-white/25 rounded-full animate-float-slow delay-2000"}),e.jsx("div",{className:"absolute bottom-1/3 right-1/3 w-1 h-1 bg-white/35 rounded-full animate-float-slow delay-3000"}),e.jsx("div",{className:"absolute bottom-1/6 left-2/3 w-2 h-2 bg-white/15 rounded-full animate-float-slow delay-4000"}),e.jsx("div",{className:"absolute top-1/2 right-1/6 w-1 h-1 bg-white/20 rounded-full animate-float-slow delay-5000"}),e.jsx("div",{className:"absolute bottom-1/2 left-1/2 w-1.5 h-1.5 bg-white/25 rounded-full animate-float-slow delay-1500"}),e.jsx("div",{className:"absolute top-3/4 left-1/2 w-1 h-1 bg-white/30 rounded-full animate-float-slow delay-2500"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-2 h-2 bg-white/10 rounded-full animate-float-slow delay-3500"}),e.jsx("div",{className:"absolute top-1/4 right-1/2 w-1 h-1 bg-white/40 rounded-full animate-float-slow delay-4500"}),e.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:50px_50px] animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-black/10"})]}),e.jsx("div",{className:"relative z-10 min-h-screen flex items-center justify-center p-6",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-white text-4xl mb-0 font-light mb-3 tracking-wide animate-slide-up",children:"Welcome to"}),e.jsxs("div",{className:"relative inline-block mb-0",children:[e.jsx("div",{className:"absolute inset-0"}),e.jsx("img",{src:"/assets/mindsphere logo.png",alt:"MindSphere",className:"relative mx-auto h-32 w-auto object-contain drop-shadow-2xl animate-float"})]}),e.jsx("p",{className:"text-white/70 text-lg font-medium tracking-wide animate-slide-up delay-200",children:"Your personalized space for growth, reflection and consistency"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/10 via-white/5 to-white/10 rounded-3xl blur-xl group-hover:blur-2xl transition-all duration-500"}),e.jsxs("div",{className:"relative backdrop-blur-2xl bg-white/5 border border-white/10 rounded-3xl px-6 py-6 shadow-2xl group-hover:bg-white/8 transition-all duration-500",children:[a&&e.jsx("div",{className:"mb-6 p-4 bg-red-500/20 border border-red-500/30 rounded-xl text-red-200 text-sm animate-pulse",children:a}),c?e.jsxs("div",{children:[e.jsxs("button",{onClick:async function(){if(!Y)return alert("Supabase not configured");s(!0);try{const{error:e}=await Y.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/`}});e&&(n("Google sign in failed. Please try again."),s(!1))}catch(e){n("Google sign in failed. Please try again."),s(!1)}},onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),disabled:t,className:"w-full group/btn relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/10 to-white/5 rounded-2xl group-hover/btn:from-white/20 group-hover/btn:to-white/10 transition-all duration-300"}),e.jsx("div",{className:"relative flex items-center justify-center gap-4 py-4 px-6",children:t?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"text-white font-medium",children:"Authenticating..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-full blur-sm"}),e.jsx("img",{src:"https://www.svgrepo.com/show/475656/google-color.svg",className:"relative h-6 w-6 drop-shadow-lg"})]}),e.jsx("span",{className:"text-white font-medium text-lg tracking-wide",children:"Sign in with Google"}),e.jsx("div",{className:"transition-transform duration-300 "+(i?"translate-x-1":""),children:e.jsx("svg",{className:"w-5 h-5 text-white/70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full group-hover/btn:translate-x-full transition-transform duration-700"})]}),!1]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-white/70 text-lg mb-6",children:"Demo mode enabled"}),e.jsxs("a",{href:"/",className:"inline-flex items-center gap-2 text-white/90 hover:text-white transition-colors group",children:[e.jsx("span",{children:"Go to app"}),e.jsx("svg",{className:"w-4 h-4 group-hover:translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),e.jsx("div",{className:"text-center mt-8 pt-6 border-t border-white/10",children:e.jsxs("p",{className:"text-white/40 text-sm font-light",children:["By continuing, you agree to our"," ",e.jsx("button",{onClick:()=>d(!0),className:"text-white/60 hover:text-white transition-colors underline decoration-white/30 hover:decoration-white/60 bg-transparent border-none cursor-pointer",children:"Privacy Policy"})]})})]})]}),e.jsxs("div",{className:"mt-12 flex justify-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-white/20 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-white/30 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-white/20 rounded-full animate-bounce delay-200"})]})]})}),e.jsx("style",{children:"\n        @keyframes fade-in {\n          from { opacity: 0; transform: translateY(20px); }\n          to { opacity: 1; transform: translateY(0); }\n        }\n        \n        @keyframes slide-up {\n          from { opacity: 0; transform: translateY(30px); }\n          to { opacity: 1; transform: translateY(0); }\n        }\n        \n        @keyframes float {\n          0%, 100% { transform: translateY(0px); }\n          50% { transform: translateY(-10px); }\n        }\n        \n        @keyframes float-slow {\n          0%, 100% { transform: translateY(0px) translateX(0px); opacity: 0.3; }\n          25% { transform: translateY(-20px) translateX(10px); opacity: 0.8; }\n          50% { transform: translateY(-10px) translateX(-5px); opacity: 0.6; }\n          75% { transform: translateY(-15px) translateX(8px); opacity: 0.9; }\n        }\n        \n        .animate-fade-in {\n          animation: fade-in 1s ease-out;\n        }\n        \n        .animate-slide-up {\n          animation: slide-up 0.8s ease-out;\n        }\n        \n        .animate-float {\n          animation: float 3s ease-in-out infinite;\n        }\n        \n        .animate-float-slow {\n          animation: float-slow 8s ease-in-out infinite;\n        }\n      "}),e.jsx(Pe,{isOpen:l,onClose:()=>d(!1)})]})}function Te({categories:t,selectedCategory:s,onCategoryChange:a,label:n="Category",disabled:i=!1}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"subtle text-indigo-300",children:n}),e.jsx("div",{className:"flex flex-wrap gap-2",role:"radiogroup","aria-label":"Category selection",children:t.map(t=>e.jsx("button",{onClick:()=>a(t.value),className:"px-3 py-1.5 rounded-xl border border-white/20 text-xs transition-all "+(s===t.value?"opacity-100 bg-gradient-to-r from-indigo-500/20 to-purple-600/20 border-indigo-400/50":"opacity-70 hover:opacity-90"),"aria-pressed":s===t.value,disabled:i,children:t.label},t.value))})]})}function Fe({value:t,onChange:s,placeholder:a="Share your thoughts...",label:n="What's on your mind? How do you feel?",maxLength:i=500,rows:r=3,onKeyPress:l,disabled:d=!1,userId:c}){const m=o.useRef(null),[u,x]=o.useState("idle"),[h,g]=o.useState(0),[p,b]=o.useState(null),[f,v]=o.useState(!1),j=o.useRef(null),y=o.useRef([]),w=o.useRef(null),N=o.useRef(null),k=o.useRef(null),S=o.useRef(null),_=o.useRef(null),C=O();o.useEffect(()=>{m.current&&(m.current.style.height="auto",m.current.style.height=m.current.scrollHeight+"px")},[t]),o.useEffect(()=>{"recording"===u&&w.current&&D()},[u]);const D=()=>{if("recording"===u&&N.current){const e=N.current.getContext("2d");if(!e)return;const t=new(window.AudioContext||window.webkitAudioContext),s=t.createAnalyser();s.fftSize=256,k.current=s;t.createMediaStreamSource(w.current).connect(s),E(e,s)}},E=(e,t)=>{const s=t.frequencyBinCount,a=new Uint8Array(s),n=()=>{if("recording"!==u)return;S.current=requestAnimationFrame(n),t.getByteFrequencyData(a),e.fillStyle="#ffffff",e.fillRect(0,0,e.canvas.width,e.canvas.height);const i=e.canvas.width/s*2.5;let r,l=0;for(let t=0;t<s;t++){r=a[t]/255*e.canvas.height;const n=r+t/s*25,o=t/s*250,d=50;e.fillStyle=`rgb(${n}, ${o}, ${d})`,e.fillRect(l,e.canvas.height-r,i,r),l+=i+1}};n()},M=async e=>{try{x("processing");const a=new File([e],"recording.webm",{type:e.type||"audio/webm"}),n=await C.mutateAsync({audio:a,user_id:c});if(n.text&&n.text.trim()){const e=t?`${t} ${n.text}`:n.text;s(e)}x("idle"),g(0)}catch(a){x("idle")}finally{_.current&&clearInterval(_.current)}};o.useEffect(()=>()=>{w.current&&w.current.getTracks().forEach(e=>e.stop()),_.current&&clearInterval(_.current),S.current&&cancelAnimationFrame(S.current)},[]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"subtle text-indigo-300",children:n}),e.jsxs("div",{className:"relative group",children:[e.jsx("textarea",{ref:m,value:t,onChange:e=>{e.target.value.length<=i&&s(e.target.value)},onKeyPress:e=>{l&&l(e)},onFocus:()=>v(!0),onBlur:()=>v(!1),placeholder:a,style:{backgroundColor:"#00000030"},className:`\n            w-full bg-gray-800 text-white border rounded-xl px-4 py-3 \n            placeholder-white/40 focus:outline-none \n            text-sm resize-none transition-all duration-300\n            backdrop-blur-sm\n            ${f?"border-white/40 shadow-lg shadow-white/10":"border-white/20 hover:border-white/30 hover:shadow-lg hover:shadow-white/5"}\n            ${d||"processing"===u?"opacity-50 cursor-not-allowed":"cursor-text"}\n          `,rows:r,disabled:d||"processing"===u}),e.jsxs("div",{className:"absolute bottom-3 right-3 flex items-center gap-2",children:["idle"===u&&e.jsx("button",{type:"button",onClick:async()=>{try{b(null);const e=await navigator.mediaDevices.getUserMedia({audio:!0});w.current=e;const t=new MediaRecorder(e);j.current=t,y.current=[],t.ondataavailable=e=>{e.data.size>0&&y.current.push(e.data)},t.onstop=()=>{const e=new Blob(y.current,{type:"audio/webm"});M(e)},t.start(),x("recording"),g(0),_.current=setInterval(()=>{g(e=>e+1)},1e3)}catch(e){b("Could not access microphone. Please check permissions.")}},disabled:d,className:"\n                w-10 h-10 flex items-center justify-center \n                text-white/80 hover:text-white \n                transition-all duration-300 rounded-xl \n                bg-gradient-to-r from-white/5 to-white/2\n                hover:from-white/10 hover:to-white/5\n                hover:scale-110 active:scale-95\n                backdrop-blur-sm border border-white/20\n                group-hover:border-white/30 hover:shadow-lg hover:shadow-white/10\n              ",title:"Record voice note","aria-label":"Start recording voice note",children:e.jsx(q,{className:"w-5 h-5"})}),"recording"===u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-gray-800/50 to-gray-700/30 border border-gray-600/40 rounded-lg backdrop-blur-sm shadow-lg shadow-gray-800/20",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse"}),e.jsx("div",{className:"text-xs text-gray-200 font-semibold",children:(I=h,`${Math.floor(I/60)}:${(I%60).toString().padStart(2,"0")}`)})]}),e.jsx("button",{type:"button",onClick:()=>{j.current&&"recording"===j.current.state&&j.current.stop(),w.current&&w.current.getTracks().forEach(e=>e.stop()),_.current&&clearInterval(_.current)},className:"\n                  w-10 h-10 flex items-center justify-center \n                  text-gray-400 hover:text-gray-300 \n                  transition-all duration-300 rounded-xl \n                  bg-gradient-to-r from-gray-800/20 to-gray-700/10\n                  hover:from-gray-800/30 hover:to-gray-700/20\n                  hover:scale-110 active:scale-95\n                  backdrop-blur-sm border border-gray-600/40\n                  hover:shadow-lg hover:shadow-gray-800/20\n                ",title:"Stop recording","aria-label":"Stop recording",children:e.jsx(F,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:()=>{j.current&&"recording"===j.current.state&&j.current.stop(),w.current&&w.current.getTracks().forEach(e=>e.stop()),_.current&&clearInterval(_.current),x("idle"),g(0),y.current=[]},className:"\n                  w-10 h-10 flex items-center justify-center \n                  text-gray-400 hover:text-gray-300 \n                  transition-all duration-300 rounded-xl \n                  bg-gradient-to-r from-gray-800/20 to-gray-700/10\n                  hover:from-gray-800/30 hover:to-gray-700/20\n                  hover:scale-110 active:scale-95\n                  backdrop-blur-sm border border-gray-600/40\n                  hover:shadow-lg hover:shadow-gray-800/20\n                ",title:"Cancel recording","aria-label":"Cancel recording",children:e.jsx("div",{className:"text-lg",children:"âœ•"})})]}),"processing"===u&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-500/20 border border-blue-400/30 rounded-lg backdrop-blur-sm",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-400/30 border-t-blue-400 rounded-full animate-spin"}),e.jsx("div",{className:"text-xs text-blue-300 font-medium",children:"Processing..."})]})]})]}),"recording"===u&&e.jsx("div",{className:"h-12 rounded-xl overflow-hidden border border-gray-300",style:{backgroundColor:"#ffffff"},children:e.jsx("canvas",{ref:N,width:400,height:48,className:"w-full h-full",style:{backgroundColor:"#ffffff"}})}),p&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 border border-white/20 rounded-xl backdrop-blur-sm",children:[e.jsx("div",{className:"text-white/80 text-lg",children:"âš ï¸"}),e.jsx("div",{className:"text-sm text-white/80 flex-1",children:p}),e.jsx("button",{onClick:()=>b(null),className:"text-white/60 hover:text-white/80 transition-colors p-1 rounded-lg hover:bg-white/10","aria-label":"Dismiss error",children:"âœ•"})]})]});var I}ke.loadFromStorage();const Le=async e=>(await V.get("/memories")).data,Re=async(e,t)=>(await V.post("/memories",{...t,importance:1})).data,ze=async e=>(await V.delete(`/memories/${e}`)).data,Ye=async e=>(await V.get("/snippets")).data,Oe=async(e,t)=>(await V.post("/snippets",{content:t})).data,qe=async e=>(await V.delete(`/snippets/${e}`)).data,Ve=[{value:"personal",label:"Personal"},{value:"work",label:"Work"},{value:"health",label:"Health"},{value:"family",label:"Family"},{value:"hobbies",label:"Hobbies"},{value:"goals",label:"Goals"},{value:"general",label:"General"}],Ge=e=>{const t=new Date(e),s=new Date,a=new Date(s.getTime()-864e5);if(t.toDateString()===s.toDateString())return"Today";if(t.toDateString()===a.toDateString())return"Yesterday";{const e=Math.abs(s.getTime()-t.getTime()),a=Math.ceil(e/864e5);return a<=7?`${a} days ago`:t.toLocaleDateString()}};function We({userId:s}){const[i,r]=o.useState({content:"",category:"general"}),[l,d]=o.useState(!1),c=a(),{data:m,isLoading:u}=t({queryKey:["user-memories",s],queryFn:()=>Le(s),enabled:!!s,retry:1,retryDelay:1e3,staleTime:6e4,refetchOnWindowFocus:!1}),x=n({mutationFn:e=>Re(s,e),onSuccess:()=>{c.invalidateQueries({queryKey:["user-memories",s]}),r({content:"",category:"general"}),d(!1)},onError:()=>{d(!1)}}),h=n({mutationFn:e=>ze(e),onSuccess:()=>{c.invalidateQueries({queryKey:["user-memories",s]})}}),g=e=>{e.preventDefault(),!i.content.trim()||x.isPending||l||(d(!0),x.mutate(i))};return u?e.jsxs(X,{children:[e.jsx("div",{className:"heading bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent",children:"Long Term Memory About Me"}),e.jsx("div",{className:"text-center text-silver py-8",children:"Loading memories..."})]}):e.jsxs(X,{children:[e.jsx("div",{className:"heading bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent",children:"Long Time Memory About Me"}),e.jsx("div",{className:"text-silver text-sm mb-4",children:"Share details about yourself that I'll remember for personalized experiences."}),e.jsx("form",{onSubmit:g,className:"mb-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Te,{categories:Ve,selectedCategory:i.category,onCategoryChange:e=>r({...i,category:e}),label:"Category"}),e.jsx(Fe,{value:i.content,onChange:e=>r({...i,content:e}),placeholder:"",onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),g(e))},disabled:x.isPending,userId:s}),e.jsx("div",{className:"mt-6",children:e.jsx(J,{label:x.isPending||l?"Saving...":"Save Memory",onClick:()=>g({preventDefault:()=>{}}),disabled:x.isPending||l||!i.content.trim(),isLoading:x.isPending||l,variant:"white",size:"md",className:"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white border-0"})})]})}),m&&m.length>0?e.jsx("div",{className:"space-y-3",children:m.map(t=>{return e.jsxs("div",{className:"bg-graphite/50 border border-white/10 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${s=t.category,{personal:"text-blue-400",work:"text-indigo-400",health:"text-green-400",family:"text-purple-400",hobbies:"text-yellow-400",goals:"text-pink-400",general:"text-gray-400"}[s]||"text-gray-400"}`,children:Ve.find(e=>e.value===t.category)?.label}),e.jsx("button",{onClick:()=>h.mutate(t.id),className:"text-red-400 hover:text-red-300 text-sm",disabled:h.isPending,children:"Delete"})]}),e.jsx("p",{className:"text-white text-sm mb-2",children:t.content}),e.jsx("div",{className:"text-xs text-silver/60",children:Ge(t.created_at)})]},t.id);var s})}):e.jsx("div",{className:"text-center text-silver",children:"No memories added yet. Start by adding one above!"})]})}const Be=e=>{const t=new Date(e),s=new Date,a=new Date(s.getTime()-864e5);if(t.toDateString()===s.toDateString())return"Today";if(t.toDateString()===a.toDateString())return"Yesterday";{const e=Math.abs(s.getTime()-t.getTime()),a=Math.ceil(e/864e5);return a<=7?`${a} days ago`:t.toLocaleDateString()}};function He({userId:s}){const[i,r]=o.useState(""),l=a(),{data:d,isLoading:c}=t({queryKey:["user-snippets",s],queryFn:()=>Ye(s),enabled:!!s,retry:1,retryDelay:1e3,staleTime:6e4,refetchOnWindowFocus:!1}),m=n({mutationFn:e=>Oe(s,e),onSuccess:()=>{l.invalidateQueries({queryKey:["user-snippets",s]}),r("")}}),u=n({mutationFn:e=>qe(e),onSuccess:()=>{l.invalidateQueries({queryKey:["user-snippets",s]})}}),x=()=>{i.trim()&&!m.isPending&&m.mutate(i)};return c?e.jsxs(X,{children:[e.jsx("div",{className:"heading bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent",children:"My Quick Thoughts"}),e.jsx("div",{className:"text-center text-silver py-8",children:"Loading snippets..."})]}):e.jsxs(X,{children:[e.jsx("div",{className:"heading bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent",children:"My Quick Thoughts"}),e.jsx("div",{className:"text-silver text-sm mb-4",children:"Share quick thoughts, ideas, or notes that I'll remember for immediate high relevance."}),e.jsx("form",{onSubmit:x,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Fe,{value:i,onChange:r,placeholder:"",maxLength:500,rows:3,onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),x())},disabled:m.isPending,userId:s}),e.jsx("div",{className:"mt-6",children:e.jsx(J,{type:"button",label:m.isPending?"Saving...":"Save Snippet",onClick:x,disabled:m.isPending||!i.trim(),isLoading:m.isPending,variant:"white",size:"md",className:"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white border-0"})})]})}),d&&d.length>0&&e.jsx("div",{className:"mt-6 space-y-3",children:d.slice(0,5).map(t=>e.jsxs("div",{className:"bg-graphite/50 border border-white/10 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"text-white text-sm flex-1",children:t.content}),e.jsx("button",{onClick:()=>u.mutate(t.id),className:"text-red-400 hover:text-red-300 text-xs ml-2",disabled:u.isPending,children:"Ã—"})]}),e.jsx("div",{className:"text-xs text-silver/60 mt-1",children:Be(t.created_at)})]},t.id))})]})}function Ke(){const t=m(),{data:s}=G(),a=W(),{userId:n,user:i,signOut:r}=I(),l=s?.user,d=s?.profile;o.useEffect(()=>{(async()=>{if("google"!==z||!Y)return;const{data:e}=await Y.auth.getUser(),t=e.user;t&&await a.mutateAsync({given_name:t.user_metadata?.full_name?.split(" ")[0]||t.user_metadata?.name||"",family_name:t.user_metadata?.full_name?.split(" ").slice(1).join(" ")||"",locale:t.user_metadata?.locale||navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone})})()},[]);return e.jsxs("div",{className:"container-narrow grid-gap fadePop",children:[e.jsx(X,{children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("img",{src:"/assets/profileavatar.png",className:"h-20 w-20 rounded-full border-2 border-indigo-400/30 shadow-lg object-cover",alt:"Profile"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 rounded-full border-2 border-slate-950 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:i?.user_metadata?.full_name||i?.display_name||l?.display_name||(d?.given_name&&d?.family_name?`${d.given_name} ${d.family_name}`:d?.given_name)||"Demo User"}),e.jsx("div",{className:"text-silver text-sm mb-2",children:i?.email||l?.email||"demo@mindsphere.app"}),l?.phone&&e.jsxs("div",{className:"text-silver text-sm mb-3 flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ“±"}),e.jsx("span",{children:l.phone})]}),e.jsxs("div",{className:"inline-flex items-center gap-1 px-3 py-2 rounded-full bg-gradient-to-r from-indigo-500/20 to-purple-600/20 border border-indigo-400/30 text-xs font-medium text-indigo-300",children:[e.jsx("span",{children:"âœ¨"}),e.jsx("span",{children:"google"===z?"Free Plan":"Demo Account"})]})]})}),e.jsx(We,{userId:n||""}),e.jsx(He,{userId:n||""}),e.jsx(X,{children:e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"w-full bg-red-500/20 hover:bg-red-500/30 text-red-400 border border-red-400/30 rounded-lg px-4 py-3 font-large transition-all duration-200",onClick:async()=>{try{"google"===z&&Y?await Y.auth.signOut():r(),t("/auth")}catch(e){t("/auth")}},children:"Logout"})})})]})}function Ue(){return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-800",children:e.jsx("div",{className:"container-narrow py-8",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(B,{onSessionStart:()=>{},onSessionEnd:()=>{},className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-8 border border-gray-700"})})})})}function Xe(){const t=c(),s=t.pathname.startsWith("/session/")||t.pathname.startsWith("/view-session/"),a="/signin"===t.pathname,{userId:n,isLoading:i}=I();return i?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 via-black to-gray-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-4"}),e.jsx("div",{className:"text-white/70 text-lg",children:"Loading MindSphere..."})]})}):n||a?n&&a?e.jsx(h,{to:"/",replace:!0}):!n&&a?e.jsx(Ae,{}):e.jsxs("div",{className:"relative animate-fadeIn",children:[!a&&e.jsx(oe,{userId:n}),e.jsxs("div",{className:s||a?"":"pb-20",children:[" ",e.jsxs(g,{children:[e.jsx(p,{path:"/",element:e.jsx(Se,{})}),e.jsx(p,{path:"/dashboard",element:e.jsx(be,{})}),e.jsx(p,{path:"/ai-buddy",element:e.jsx(Ue,{})}),e.jsx(p,{path:"/voice-interface",element:e.jsx(K,{})}),e.jsx(p,{path:"/session/:sessionId",element:e.jsx(Ie,{})}),e.jsx(p,{path:"/view-session/:sessionId",element:e.jsx($e,{})}),e.jsx(p,{path:"/signin",element:e.jsx(Ae,{})}),e.jsx(p,{path:"/profile",element:e.jsx(Ke,{})}),e.jsx(p,{path:"*",element:e.jsx(Se,{})})]})]}),!s&&!a&&e.jsx(ce,{userId:n})]}):e.jsx(h,{to:"/signin",replace:!0})}function Je(){return e.jsx(H,{children:e.jsx(ie,{children:e.jsx(te,{children:e.jsx(x,{children:e.jsx(Xe,{})})})})})}const Qe=new i,Ze=document.getElementById("root");Ze&&Q(Ze).render(e.jsx(r,{client:Qe,children:e.jsx(Je,{})}));
